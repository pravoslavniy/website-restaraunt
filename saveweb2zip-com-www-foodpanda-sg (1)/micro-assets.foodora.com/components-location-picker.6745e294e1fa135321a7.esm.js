(self.__LOADABLE_LOADED_CHUNKS__=self.__LOADABLE_LOADED_CHUNKS__||[]).push([[68022],{e2ba54487d3e9f01ee4a:(e,t,s)=>{"use strict";s.d(t,{Ob:()=>f,qH:()=>S,Nr:()=>c,iv:()=>d,ts:()=>h,ph:()=>l,SU:()=>u,OX:()=>g,up:()=>b,Ux:()=>p,K4:()=>v});var i=s("d7f2db0229e7c7df3214"),o=s("94217eecef624954b619"),a=s("ef7f39a531ad1aecc167"),n=(s("01fc610540474aad81ff"),s("56d5f2391e2ec098aa40"),s("8f58e784196e6568c885"),s("aa19b366ad39a81067fe"),s("12be0f0e9e2c7751d613"));var r=s("9592de066f63f0afd04d");const d=(e,t)=>e.filter((e=>{let{id:s}=e;return s!==t.id})),c=(e,t)=>e.map((e=>{const{type:s,label:i}=t;return(0,a.Fz)(e.type)===(0,a.Fz)(s)&&e.label===i&&(e.type=o._.OTHER,e.label=void 0),e})),l=()=>localStorage.getItem("provider"),h=async e=>{if(e&&e.id){const t=await(async(e,t)=>{let s={provider:l()};const o=await t;if(o&&o.meta)try{s=JSON.parse(o.meta)}catch(t){i.k.error({error:new Error,message:"cannot parse the address meta data for:"+e})}return s})(e.id,e);return t}if(e&&"meta"in e)try{return JSON.parse(e.meta)}catch(e){}return{provider:l()}},p=(e,t)=>(0,r.d)(t)?!!e.mapping&&!e.is_hidden:e.properties.is_dynamic_field&&!e.properties.is_always_shown,u=(e,t)=>(0,r.d)(t)?!!e.mapping&&!e.is_hidden:!!e.mapping,g=(e,t)=>(0,r.d)(t)?!e.mapping:!e.mapping||!!e.properties.is_always_shown,m=(e,t,s,i)=>e.filter((e=>e.mapping)).filter((e=>p(e,i))).filter((e=>{var o,a,n,d,c,l;if((0,r.d)(i))return!0;const h=t&&t[e.name]?t[e.name]:void 0;return"address_line1"===e.name&&"Unnamed Road"===h||(!h||("user"===(null==s||null===(o=s.dynamic_fields)||void 0===o||null===(a=o[e.name])||void 0===a?void 0:a.source)||"user_edited"===(null==s||null===(n=s.dynamic_fields)||void 0===n||null===(d=n[e.name])||void 0===d?void 0:d.source)||"google"!==(null==s||null===(c=s.dynamic_fields)||void 0===c||null===(l=c[e.name])||void 0===l?void 0:l.source)&&(!(s&&s.dynamic_fields&&!s.dynamic_fields[e.name]||s&&!s.dynamic_fields)&&!h)))})),S=(e,t,s,i)=>{const{fields:o,dynamic_fields_properties:a}=i,n=null==a?void 0:a.exclude_from_cities,d=(null==n?void 0:n.some((t=>e.city_id&&e.city_id.toString()===t)))?[]:(0,r.d)(s)?m(o,e,t,s):m(o,e,t).slice(0,1),c=o.filter((e=>g(e,s)));return d[0]?[...d,...c]:[...c]},f=function(e,t,s){if(void 0===e&&(e={}),void 0===s&&(s=!1),!e.addressId&&!s)return{};const i={};return t.forEach((t=>{i[t.name]=e[t.name],"phone_number"===t.name&&(i.phone_country_code=e.phone_country_code)})),"Unnamed Road"===i.address_line1&&delete i.address_line1,i.type=e.type?e.type:o._.OTHER,i.label=e.label,i},v=(e,t,s,i,o,a,n)=>{const r=((e,t,s)=>e.reduce(((e,i)=>(p(i,s)&&(e[i.name]=!!t[i.name]),e)),{}))(e,t,n),d=a.getLastStepType();o.trackAddressUpdated(s,d,r,(e=>e?e.id:void 0)(i)?"EditAddress":"NewAddress")},b=(e,t,s)=>{n.ZP.getInstance().getGTMLocationService().trackLocationError("NO_RESULTS_FOUND","Saved",e,t,s)}},"9592de066f63f0afd04d":(e,t,s)=>{"use strict";s.d(t,{d:()=>r,u:()=>n});var i=s("8f58e784196e6568c885"),o=s.n(i);let a=function(e){return e.VARIATION1="Variation1",e.CONTROL="Control",e.NA="N/A",e}({});const n=e=>o()(e,'features.flags["loc-new-dynamic-fields"]',a.CONTROL),r=e=>!!e&&n(e)===a.VARIATION1},cf8b9eba67b9e579aba1:(e,t,s)=>{"use strict";s.d(t,{z:()=>se});var i=s("54bdd803dcbe7795ce01"),o=s.n(i),a=s("281cbdced79d8f3d2562"),n=s.n(a),r=s("e56aa86c532afce58654"),d=s.n(r),c=s("3ea3cb108c28f44a15b3"),l=s("4d4238b3f32bba880178"),h=s("e57816ce2d5f3e48376c"),p=s("174811872339f1d02c40"),u=s.n(p),g=s("69084d01d3449fc1bc27"),m=s("787980cc545b28bdd6fd"),S=s("bd11212dd200c13dd4e4"),f=s("b48d419be3e1903edcd4"),v=s("12be0f0e9e2c7751d613"),b=s("6fd2852d6f9220b4ea44"),A=s("8925fd7ba214b7a70d3b"),C=s("77dd625b88c8b2482c64"),L=s("c7ab47c92a9c64e9f43d"),_=s("b6c652ac9318741b9db2"),E=s("df45c342335190e4d755"),y=s.n(E);let x=function(e){return e.LocateMeCircular="locate-me-circular",e.LocateMeWithText="locate-me-with-text",e}({});var T=s("568ecdc81696e6199594"),N=s("9302435e81c621e827fb");const M=e=>(0,N.jsx)("div",{"data-testid":"locate-me-suggestion",onClick:e.locateMe,onKeyDown:e.locateMe,role:"presentation",className:"locate-me-component",children:!e.isLoading&&(e.showLocateMeText?(0,N.jsx)(_.Button,{"data-testid":x.LocateMeWithText,ariaLabel:e.translations&&e.translations.A11Y_ICON_LOCATE_ME,onKeyDown:e.locateMe,className:"locate-me locate-me-btn\n            "+(e.isMapOpen?"text-map-opened":"text-map-closed")+" \n            "+(e.placement===T.yf.default?"default-locate-me-with-text":"")+"\n            "+(e.placement===T.yf.modalMap?"map-locate-me-with-text":"")+"\n            "+(e.isLocateMeClicked?"locate-me-clicked":"")+"\n            "+(e.isLocationFound?"location-found":"")+"\n            ",variant:e.isMapOpen&&e.placement===T.yf.modalMap?"secondary":"text",prefix:(0,N.jsx)(y(),{}),children:e.translations&&e.translations.A11Y_ICON_LOCATE_ME}):(0,N.jsx)(L.ButtonCircular,{"data-testid":x.LocateMeCircular,ariaLabel:e.translations?e.translations.A11Y_ICON_LOCATE_ME:"",onKeyDown:e.locateMe,className:"locate-me locate-me-btn-refresh\n            "+(e.isMapOpen?"map-opened":"map-closed")+" \n            "+(e.placement===T.yf.modalMap?"map-locate-me":"")+"\n            "+(e.isLocateMeClicked?"locate-me-clicked":"")+"\n            "+(e.isLocationFound?"location-found":"")+"\n        ",children:(0,N.jsx)(y(),{id:"locate-me"})}))});var w=s("549640134fdb6d7e36d7");const O=e=>{const t=()=>{var t;t=w.B.ATTEMPTED,e.trackInputState&&e.trackInputState(t),e.addressChangeTracker.setLastStepType("LocateMe"),e.gtmLocationService.trackLocateMeStart(),e.gtmLocationService.initializeLocationAttemptedTracking("LocateMe");const s=e.selectedAddress||new S.C;e.gtmLocationService.trackLocationClicked(s,e.vendor,e.formType,"LocateMe"),e.gtmLocationService.trackLocationAttempted(s,e.vendor,e.formType)},s=(t,s)=>{const i="granted"===s?C.KK.GPS_ENABLED:C.KK.GPS_PERMISSION_DENIED,o=i===C.KK.GPS_ENABLED;"prompt"===t&&e.gtmLocationService.trackGeolocationDialogStatus(i,o)},handleLocateMeError=()=>{var t,s;(e.changeStateValue({isLoading:!1,isLocateMeClicked:!1,isLocationFound:!1}),e.onLocateMeFail)?(e.onLocateMeFail(),(0,h.v)().emit("geolocation:permission-denied")):(e.changeShouldRetrieveSuggestionsValue(!0),e.displayError(b.X.NO_GEOLOCATION),e.gtmLocationService.trackLocationError("NO_GEOLOCATION","LocateMe"),e.changeStateValue({errorState:b.X.NO_GEOLOCATION}),e.inputRef&&null!==(t=e.inputRef)&&void 0!==t&&null!==(s=t.current)&&void 0!==s&&s.focus&&e.inputRef.current.focus());(0,h.v)().emit("full-address-search:locate-me-error")},i=()=>{e.addressSuggestionCollection&&e.addressSuggestionCollection.length>=0&&e.changeStateValue({addressSuggestionCollection:[],showSuggestions:!1}),e.onSuggestionListChanged&&e.onSuggestionListChanged(e.addressSuggestionCollection);const i=new A.Z(e.gtmLocationService);e.hiddenError(e.inputRef),t(),e.changeStateValue({isLoading:!0,isLocateMeClicked:!0}),i.getAddress().then((t=>{var i,o;e.changeStateValue({isLoading:!1}),s(e.gpsPermission,"granted"),(o=t)instanceof S.C&&(e.changeStateValue({value:o.formatted_customer_address,isLocateMeClicked:!1,isLocationFound:!0}),e.onChange&&e.onChange(o,!e.autoSubmit)),(0,h.v)().emit("full-address-search:locate-me-end"),null===(i=e.onSuggestionListSelected)||void 0===i||i.call(e,t)})).catch((()=>{s(e.gpsPermission,"denied"),handleLocateMeError()}))};return(0,g.useEffect)((()=>{e.noAddressOpenMap&&i()}),[e.noAddressOpenMap]),(0,N.jsx)(N.Fragment,{children:(0,N.jsx)(M,{translations:e.translations,locateMe:i,isLocateMeClicked:e.isLocateMeClicked,isLocationFound:e.isLocationFound,isMapOpen:e.isMapOpen,placement:e.placement,useCurrentLocationText:e.useCurrentLocationText,appConfig:e.appConfig,isWhereComponent:e.isWhereComponent,isLoading:e.isLoading,showLocateMeText:e.showLocateMeText})})};var I=s("6602d2ed10acb4d71eb7"),D=s("a7f44a4d9a149fde3658"),j=s("df328cdcf0c55bfa25c7"),k=s.n(j),R=s("b074c3cb17f204ecf6a8"),P=s.n(R),F=s("9f3f340b65c456465766"),V=s.n(F);function B(e){return"saved address"===e.object_type}var U=s("357b5e421c562f4d34f8"),G=s("973a878031e1dd3a94c7"),W=s.n(G),H=s("a7dceeac37519cfc1804"),K=s("1c2f52c061810467b454"),X=s("ef7f39a531ad1aecc167");const z=e=>{const{formatted_customer_address:t}=e;return t||v.ZP.getInstance().getAddressFormatter().getFormattedAddress(e)},Z=e=>{let{model:t}=e;const s=(0,H.T)();return(0,N.jsxs)(N.Fragment,{children:[(0,K.v)((0,X.Fz)(t.type)),(0,N.jsxs)(U.Box,{className:"labeled-address",color:"neutral-primary",children:[(0,N.jsxs)(V(),{className:"label",as:"h4",type:"label-md",margin:"zero",children:[" ",(0,X.FE)((0,X.Kt)(s),t)," "]}),(0,N.jsxs)(V(),{className:"main-address",type:"paragraph-sm",children:[" ",z(t)," "]})]})]})},Y=e=>{let{model:t}=e;return(0,N.jsx)(N.Fragment,{children:null!=t&&t.is_company_address?(0,N.jsxs)(N.Fragment,{children:[(0,N.jsx)(W(),{fill:"interaction-primary"}),(0,N.jsxs)(V(),{className:"main-address",type:"paragraph-sm",color:"neutral-primary",children:[" ",z(t)," "]})]}):(0,N.jsx)(Z,{model:t})})};function q(e){const t=()=>{e.handleAddressSelect&&e.handleAddressSelect(e.model)},s=()=>{e.onHover&&e.onHover(e.model)},i=e.model.object_type,o="saved address"===i;return o||"company address"===i?(0,N.jsx)("li",{onClick:t,className:u()("suggestion-item",{focused:e.isFocus}),onMouseEnter:s,"data-testid":"suggestion-item",children:(0,N.jsx)("div",{className:"item saved-address","data-testid":o&&!e.model.corporate_reference_id?"suggestion-item__saved-address":"suggestion-item__company-address",children:(0,N.jsx)(Y,{model:e.model})})}):(0,N.jsx)("li",{onClick:t,className:u()("suggestion-item",{focused:e.isFocus}),onMouseEnter:s,"data-testid":"suggestion-item",children:(0,N.jsx)("div",{className:"item autocomplete",children:(0,N.jsxs)(V(),{className:"main-address",type:"paragraph-sm",color:"neutral-primary",children:[" ",e.model.formatted_customer_address," "]})})})}Y.displayName="SavedAddressItem",Z.displayName="LabledAddress";const J=e=>{let{addressSuggestionCollection:t,focusedItem:s,focusItem:i,selectAddress:a,translations:n}=e;const r=(null!=t?t:[]).every((e=>B(e))),d=r?n.saved_addresses_label:n.map_noresult_correction_text,c=u()("address-suggestions","webfound-refresh",{"saved-addresses":r});return(0,N.jsxs)("div",{className:c,id:"address-suggestions","data-testid":"address-suggestions",children:[(0,N.jsx)(V(),{className:"address-suggest-title",color:"neutral-primary",type:"label-sm",children:d}),(0,N.jsx)("ul",{className:"address-suggestion-items",children:(null!=t?t:[]).map((e=>{const t=u()("address-suggestion-item",{"address-suggestion-item--is-focus":s&&o()(e,s)}),n=B(e);return(0,N.jsx)(N.Fragment,{children:n?(0,N.jsx)(q,{model:e,isFocus:s&&o()(e,s),onHover:i,handleAddressSelect:a},e.id):(0,N.jsxs)("li",{className:t,"data-testid":"address-suggestion-item",onClick:()=>a(e),onMouseOver:()=>i(e),children:[(0,N.jsx)(P(),{className:"address-suggestion-item-icon-search"}),(0,N.jsx)("span",{className:"address",children:(0,N.jsx)(V(),{type:"paragraph-sm",color:"interaction-secondary",children:e.formatted_customer_address})}),(0,N.jsx)(k(),{className:"address-suggestion-item-icon-diagonal"})]},e.id)})}))})]})};let $=function(e){return e[e.UP=0]="UP",e[e.DOWN=1]="DOWN",e}({});class Q extends g.PureComponent{static getDerivedStateFromProps(e){return{addressSuggestionCollection:e.addressSuggestionCollection,inputNode:e.inputNode}}constructor(e){super(e),this.enterCallback=void 0,this.isSuggestionSelected=!1,this.gtmLocationService=void 0,this.gtmLocationService=v.ZP.getInstance().getGTMLocationService();const t=e.addressSuggestionCollection;this.state={addressSuggestionCollection:t},this.enterCallback=n()(this.onEnter,500),this.handleBodyClick=this.handleBodyClick.bind(this),this.selectAddress=this.selectAddress.bind(this),this.focusItem=this.focusItem.bind(this)}componentDidMount(){document.body.addEventListener("click",this.handleBodyClick,!1),document.body.addEventListener("touchstart",this.handleBodyClick,!1)}componentWillUnmount(){document.body.removeEventListener("click",this.handleBodyClick,!1),document.body.removeEventListener("touchstart",this.handleBodyClick,!1)}render(){return(0,N.jsx)(J,{addressSuggestionCollection:this.props.addressSuggestionCollection,focusedItem:this.state.focusedItem,focusItem:this.focusItem,locateMeComponent:this.props.locateMeComponent,selectAddress:this.selectAddress,translations:this.props.translations})}moveFocusedItem(e){var t;const{addressSuggestionCollection:s,focusedItem:i}=this.state,{setInputValue:a}=this.props;if(!s)return;if(!this.state.focusedItem){const t=e===$.DOWN?0:s.length-1;return this.focusItem(s[t]),void a(s[t].formatted_customer_address)}let n;const r=s.findIndex((e=>o()(e,i)));n=e===$.DOWN?r===s.length-1?s[0]:s[r+1]:0===r?s[s.length-1]:s[r-1],this.focusItem(n),a(null===(t=n)||void 0===t?void 0:t.formatted_customer_address)}composedPath(e){const t=[];for(;e;){if(t.push(e),"HTML"===e.tagName)return t.push(document,window),t;e=e.parentElement}}onEnter(){const e=this.state.focusedItem;e?this.selectAddress(e):this.state.addressSuggestionCollection&&this.selectAddress(this.state.addressSuggestionCollection[0])}isSavedAddressCollection(e){return e&&e.length>0&&!!e[0].id}handleAddressSelectionOnUnfocusedInput(){const e=v.ZP.getInstance().getModel(),t=e.latitude&&e.longitude?e:void 0,{addressSuggestionCollection:s}=this.state;s&&s.length>0&&!this.isSavedAddressCollection(s)?this.props.handleAddressSelect(s[0],!0):t?this.props.handleAddressSelect(t,!1,!0):this.props.hideAddressSuggestions()}handleBodyClick(e){let t;switch(!0){case e.path:t=e.path;break;case"function"==typeof e.composedPath:t=e.composedPath();break;default:const s=e.target||e.srcElement;t=this.composedPath(s)}this.isBodyClickOutsideOfSuggestionsContainer(t)&&(this.props.autoSelect&&this.handleAddressSelectionOnUnfocusedInput(),this.gtmLocationService&&this.gtmLocationService.resetLocationAttemptedTracking())}isBodyClickOutsideOfSuggestionsContainer(e){return!e.find((e=>e.classList&&e.classList.contains("validation-wrapper")))}focusItem(e){this.setState({focusedItem:e},(()=>{this.isSuggestionSelected||(this.isSuggestionSelected=!0)}))}selectAddress(e){if(e){if(this.setState({selectedSaveAddress:null}),this.gtmLocationService){const t=e.id?"Saved":"Autocomplete";this.gtmLocationService.initializeLocationAttemptedTracking(t),this.gtmLocationService.trackLocationAttempted(e,this.props.vendor,this.props.formType)}this.props.handleAddressSelect(e),this.isSuggestionSelected=!1}}}Q.defaultProps={autoSelect:!0};var ee=s("5a5afc411b33944d3a7e"),te=s("5bac396c86413df162b8");class se extends g.PureComponent{static getDerivedStateFromProps(e,t){const s=!o()(e.selectedAddress,t.selectedAddress);return{expeditionType:e.expeditionType,selectedAddress:s?e.selectedAddress:t.selectedAddress,errorState:s?null:t.errorState}}constructor(e){super(e),this.getSuggestions=void 0,this.suggestionsPromise=void 0,this.debouncedPopulateSuggestions=void 0,this.addressSuggestionCollection=void 0,this.suggestionRef=void 0,this.isAttempted=void 0,this.snapShot=void 0,this.gpsPermission="",this.shouldRetrieveSuggestions=!1,this.handleSetLoadingStateEvent=e=>{this.changeStateValue({isLoading:e})},this.handleLocationInputComponentDisplayErrorEvent=e=>{this.setState({errorState:e}),this.hideSuggestions()},this.getAddressSuggestionCollection=()=>this.state.addressSuggestionCollection||[],this.renderLocateMeButtonComponent=e=>{let{placement:t,addressBookPhase3EnabledMweb:s=!1,showLocateMeText:i=!1}=e;return(0,N.jsx)(O,{translations:this.props.translations,isWhereComponent:this.props.isWhereComponent,autoSubmit:this.props.autoSubmit,hiddenError:this.props.hiddenError,gtmLocationService:this.props.gtmLocationService,inputRef:this.props.inputRef,gpsPermission:this.gpsPermission,addressSuggestionCollection:this.addressSuggestionCollection,onSuggestionListChanged:this.props.onSuggestionListChanged,changeStateValue:this.changeStateValue,addressChangeTracker:this.props.addressChangeTracker,selectedAddress:this.state.selectedAddress,vendor:this.props.vendor,formType:this.props.formType,trackInputState:this.props.trackInputState,onChange:this.props.onChange,appConfig:this.props.appConfig,onLocateMeFail:this.props.onLocateMeFail,displayError:this.props.displayError,changeShouldRetrieveSuggestionsValue:this.changeShouldRetrieveSuggestionsValue,isLoading:this.state.isLoading,isLocateMeClicked:this.state.isLocateMeClicked,isLocationFound:this.state.isLocationFound,isMapOpen:this.props.isMapOpen,noAddressOpenMap:this.props.noAddressOpenMap,placement:t,useCurrentLocationText:this.props.translations.location_current_location_cta,addressBookPhase3EnabledMweb:s,onSuggestionListSelected:this.props.onSuggestionListSelected,showLocateMeText:i})},this.getRequiredFieldsWithMapping=()=>{const{multiline_formatted_address:e,fields:t}=this.props.appConfig.address_config,s=e.join(" ").replace(/[\{\}:,']+/g,"").split(" ");for(let e=0;e<s.length;e++)for(let i=0;t&&i<t.length;i++)s[e]===t[i].name&&(s[e]=t[i].df_name);return s.join(", ").replace(/_/g," ")},this.getLocateMeButtonPosition=e=>e===T.yf.modalMap?T.yf.modalMap:T.yf.default,this.initGPSPermissions(),this.getSuggestions=this.initGetSuggestions(),this.suggestionRef=g.createRef(),this.handleInputKeyPress=this.handleInputKeyPress.bind(this),this.OnInputFocus=this.OnInputFocus.bind(this),this.debouncedPopulateSuggestions=n()(this.populateSuggestions,250),this.handleInputChange=this.handleInputChange.bind(this),this.onAddressSelect=this.onAddressSelect.bind(this),this.isAttempted=!1,this.onInputClick=this.onInputClick.bind(this),this.onCancelSearch=this.onCancelSearch.bind(this),this.onClearClick=this.onClearClick.bind(this),this.setTrackingStatus=this.setTrackingStatus.bind(this),this.populateSuggestions=this.populateSuggestions.bind(this),this.setInputValue=this.setInputValue.bind(this),this.changeStateValue=this.changeStateValue.bind(this),this.emptySearchInput=this.emptySearchInput.bind(this),this.hideSuggestions=this.hideSuggestions.bind(this),this.state={selectedAddress:e.selectedAddress||null,expeditionType:null,addressSuggestionCollection:this.addressSuggestionCollection,value:this.emptySearchInput(e.fillInputSearch)?"":this.getInputValue(),placeId:"",focusAddressSuggestionDirection:"",selectedSaveAddress:null,showSuggestions:!1,isLoading:!1,isLocateMeClicked:!1,isLocationFound:!1,captchaResponse:null},this.snapShot=Object.assign({},this.state)}getInputValue(){const{selectedAddress:e}=this.props;if(e){const{formatted_customer_address:t}=e;return t||v.ZP.getInstance().getAddressFormatter().getFormattedAddress(e)}return""}initGetSuggestions(){return(0,m.ZP)(this.props.appConfig,this.props.showSavedAddress,this.props.locationService.getAddressService())}async initGPSPermissions(){if(navigator.permissions&&"function"==typeof navigator.permissions.query)try{const e=await navigator.permissions.query({name:"geolocation"});this.gpsPermission=e?e.state:""}catch(e){this.gpsPermission=""}}componentDidMount(){this.props.focusOnRender&&this.props.inputRef.current&&this.props.inputRef.current.focus(),this.props.hasLocationPermissionError&&this.handleLocateMeError()}registerNoAutocompleteEvents(){this.props.locationService.getEventLord().on("full-address-input-search-view:set-loading-state",this.handleSetLoadingStateEvent),this.props.locationService.getEventLord().on("location-input-component:displayError",this.handleLocationInputComponentDisplayErrorEvent)}emptySearchInput(e){return void 0===e&&(e=!0),!e}componentDidUpdate(e){this.props.selectedAddress&&!o()(e.selectedAddress,this.props.selectedAddress)?this.setState({selectedAddress:this.props.selectedAddress,value:this.getInputValue()}):this.emptySearchInput(this.props.fillInputSearch)&&this.setState({value:""}),this.props.clearAddress!==e.clearAddress&&this.onClearClick()}handleLocateMeError(){this.changeStateValue({isLoading:!1}),this.props.onLocateMeFail?(this.props.onLocateMeFail(),(0,h.v)().emit("geolocation:permission-denied")):(this.shouldRetrieveSuggestions=!0,this.showLocateMeError(),this.props.inputRef&&this.props.inputRef.current&&this.props.inputRef.current.focus()),(0,h.v)().emit("full-address-search:locate-me-error")}showLocateMeError(){this.props.displayError(b.X.NO_GEOLOCATION),this.props.gtmLocationService.trackLocationError("NO_GEOLOCATION","LocateMe"),this.setState({errorState:b.X.NO_GEOLOCATION})}async geocode(){const e=this.state.placeId,t=this.state.value,s=await(e?f.i.getInstance().getDetails({id:e}):f.i.getInstance().getGeocode({address:t}));return this.props.geocodeHandler&&this.props.geocodeHandler(s),s}scrollToInputOnMobile(){const{isMobileDevice:e,userDeviceOs:t}=(0,l.Z)();if(e&&"Android"===t){const e=document.querySelector(".location-form");e&&window&&window.scroll(0,e.offsetTop)}}changeShouldRetrieveSuggestionsValue(e){this.shouldRetrieveSuggestions=e}OnInputFocus(){this.scrollToInputOnMobile(),this.props.focusOnInput&&this.props.focusOnInput(!0),this.setTrackingStatus(w.B.CLICKED),this.props.gtmLocationService&&(this.props.gtmLocationService.initializeLocationAttemptedTracking("Search"),this.props.gtmLocationService.trackLocationClicked(this.state.selectedAddress,this.props.vendor,this.props.formType,"Search")),this.isAttempted=!1,this.shouldRetrieveSuggestions?this.shouldRetrieveSuggestions=!1:this.populateSuggestions(this.state.value,this.getInputElOffset(),te.T.SAVED_ADDRESS)}setTrackingStatus(e){this.props.trackInputState&&this.props.trackInputState(e)}onInputClick(){this.snapShot||(this.snapShot=Object.assign({},this.state)),this.state.errorState===b.X.EMPTY_INPUT&&this.setState({errorState:null})}getInputElOffset(){if(this.props.inputRef&&this.props.inputRef.current){const{selectionStart:e,selectionEnd:t}=this.props.inputRef.current;return e===t?e:null}return null}populateSuggestions(e,t,s){this.setState({isLoading:!0}),this.suggestionsPromise=this.getSuggestions(e,t,s),this.suggestionsPromise.then(this.populateIfLastSuggestionsPromise(this.suggestionsPromise,s,e).bind(this)).catch((t=>{if(s===te.T.SAVED_ADDRESS){var i;const e=v.ZP.getInstance().getLocationXhrService().isAppIdExist(t),s=(null==t||null===(i=t.response)||void 0===i?void 0:i.data)||t;e&&this.setState({captchaResponse:s}),this.setState({isLoading:!1})}else{this.setState({errorState:b.X.NO_GEOLOCATION,isLoading:!1});const t=new S.C({formatted_customer_address:e});this.props.gtmLocationService.trackLocationError("NO_GEOLOCATION","Search",t,this.props.formType),this.props.displayError(b.X.NO_GEOLOCATION)}}))}populateIfLastSuggestionsPromise(e,t,s){return i=>{if(this.setState({captchaResponse:null}),this.suggestionsPromise===e){var o;if(!this.props.disableAutoValidation){if(0===i.length&&t===te.T.AUTOCOMPLETE){this.setState({errorState:b.X.INVALID_ADDRESS_NOT_FOUND});const e=new S.C({formatted_customer_address:s});this.props.gtmLocationService.trackLocationError("NO_RESULTS_FOUND","Search",e,this.props.formType),this.props.displayError(b.X.INVALID_ADDRESS_NOT_FOUND)}else t===te.T.AUTOCOMPLETE&&this.hideError()}this.addressSuggestionCollection=i,this.props.onSuggestionListChanged&&t===te.T.AUTOCOMPLETE&&this.props.onSuggestionListChanged(this.addressSuggestionCollection),this.setState({addressSuggestionCollection:this.addressSuggestionCollection,showSuggestions:(null===(o=this.addressSuggestionCollection)||void 0===o?void 0:o.length)>0,isLoading:!1},(()=>{this.props.onSuggestionListChanged&&this.props.onSuggestionListChanged(this.addressSuggestionCollection)}))}}}resetSuggestions(){this.addressSuggestionCollection&&this.addressSuggestionCollection.length>=0&&(this.addressSuggestionCollection=[],this.setState({addressSuggestionCollection:null,showSuggestions:!1})),this.props.onSuggestionListChanged&&this.props.onSuggestionListChanged(this.addressSuggestionCollection)}showSuggestions(e){this.debouncedPopulateSuggestions(this.state.value,this.getInputElOffset(),e),this.hideError()}handleInputKeyPress(e){if(38===e.keyCode)e.preventDefault(),this.suggestionRef.current&&this.suggestionRef.current.moveFocusedItem($.UP);else if(40===e.keyCode)e.preventDefault(),this.suggestionRef.current&&this.suggestionRef.current.moveFocusedItem($.DOWN);else if(13===e.keyCode){var t,s;e.preventDefault(),null===(t=this.suggestionRef.current)||void 0===t||null===(s=t.enterCallback)||void 0===s||s.call(t)}else 27===e.keyCode&&this.resetSuggestions()}handleInputChange(e,t){var s;void 0===t&&(t=null);const i=v.ZP.getInstance().getConfig().address_config.autocomplete_min_length||3;this.setTrackingStatus(w.B.ATTEMPTED),this.props.onTouched&&this.props.onTouched(!1),this.props.addressChangeTracker.setLastStepType("Search"),this.setState({errorState:0===(null==e||null===(s=e.target)||void 0===s?void 0:s.value)?b.X.EMPTY_INPUT:null,value:e?e.target.value:t},(()=>{const e=this.state.value.trim().length<i;this.props.gtmLocationService&&(this.isAttempted||(this.props.gtmLocationService.trackLocationAttempted(this.state.selectedAddress,this.props.vendor,this.props.formType),this.isAttempted=!0)),this.showSuggestions(e?te.T.SAVED_ADDRESS:te.T.AUTOCOMPLETE),this.hideError()}))}hideError(){this.props.hiddenError(this.props.inputRef)}onAddressChange(e,t){const{onChange:s,onSuggestionListSelected:i}=this.props;s&&s(e,t),null==i||i(e)}handleCachedAddressSelection(e){const{selectedAddress:t,selectedSaveAddress:s}=this.state;this.hideSuggestions(),this.changeStateValue({isLoading:!1}),t||(s?this.onAddressChange(s,!1):this.setState({placeId:e.place_id,selectedAddress:e},(()=>this.onAddressChange(e,!1))))}onCachedAddressSelect(e){this.state.errorState?(this.hideSuggestions(),this.changeStateValue({isLoading:!1})):this.handleCachedAddressSelection(e)}handleAddressSelection(e,t){const{id:s,is_company_address:i=!1}=e,{appConfig:o,disableAutoValidation:a}=this.props,{selectedSaveAddress:n}=this.state;switch(!0){case"b2b"===o.platform&&i:const r=Object.assign({},n,{corporate_reference_id:s,is_company_address:!0});return this.onAddressChange(r,t),void this.changeStateValue({isLoading:!1});case!!n:return this.onAddressChange(n,t),void this.changeStateValue({isLoading:!1});case a:return this.onAddressChange(e,t),void this.changeStateValue({isLoading:!1});default:return void this.geocode().then((e=>{e.object_type="autocomplete",this.onAddressChange(e,t),this.changeStateValue({isLoading:!1})}))}}onAddressSelect(e,t,s){void 0===t&&(t=!1),void 0===s&&(s=!1);const{errorState:i}=this.state,{addressChangeTracker:o,focusOnInput:a,formType:n,gtmLocationService:r,onSuggestionListChanged:d,onTouched:c,vendor:l}=this.props;if(i||this.changeStateValue({isLoading:!0}),a&&a(!1),d&&d(this.addressSuggestionCollection),s)return void this.onCachedAddressSelect(e);c&&c(!0);const h=e.id?"Saved":"Autocomplete";"Saved"===h&&r.trackLocationAttempted(e,l,n),o.setLastStepType(h);const p=e.object_type;this.setState({selectedSaveAddress:"saved address"===p||"company address"===p?e:null,placeId:e.place_id,selectedAddress:e},(()=>{this.resetSuggestions(),this.handleAddressSelection(e,t)}))}hideSuggestions(){this.setState({showSuggestions:!1})}onCancelSearch(){this.props.onCancelSearch?(this.props.onCancelSearch(),this.state.errorState===b.X.EMPTY_INPUT&&this.setState({errorState:null})):(this.setState(this.snapShot),this.snapShot=null,this.hideSuggestions())}onClearClick(){this.hideSuggestions(),this.hideError(),this.props.clearInputRef&&this.props.clearInputRef(!1),this.setState({value:"",selectedAddress:null},(()=>{this.props.inputRef.current&&this.props.inputRef.current.focus()}))}setInputValue(e){e&&this.setState({value:e})}changeStateValue(e){this.setState(e)}render(){const e=this.getAddressSuggestionCollection(),t=u()("validation-wrapper input-box js-input-box","sr input-box js-input-box",{"validation-wrapper-Mweb":this.props.isWhereComponent&&(0,D.J)(this.props.isWhereComponent)},{big:this.props.inputSize&&this.props.inputSize===te.v.BIG});return(0,N.jsxs)(N.Fragment,{children:[(0,N.jsx)("div",{className:t,children:(0,N.jsxs)("div",{className:"search-input-container",children:[(0,N.jsx)("input",{type:"text",className:"restaurants-search-form__input restaurants__location__input",id:"delivery-information-postal-index",name:"",placeholder:this.props.placeholder,value:this.state.value,autoComplete:"off",onFocus:this.OnInputFocus,onKeyDown:this.handleInputKeyPress,ref:this.props.inputRef,onChange:this.handleInputChange,"data-placeid":this.state.placeId,onClick:this.onInputClick,"data-testid":"restaurants-search-form__input","aria-autocomplete":"list"}),(0,N.jsx)("strong",{className:"invalid-error-message",children:this.props.toolTipMsg}),this.state.showSuggestions&&(0,N.jsx)(Q,{appConfig:this.props.appConfig,ref:this.suggestionRef,addressSuggestionCollection:e,showSavedAddress:this.props.showSavedAddress,inputNode:this.props.inputRef&&this.props.inputRef.current?this.props.inputRef.current:void 0,addressSuggestionAction:this.state.focusAddressSuggestionDirection,handleAddressSelect:this.onAddressSelect,vendor:this.props.vendor,formType:this.props.formType,autoSelect:!0,setInputValue:this.setInputValue,translations:this.props.translations,hideAddressSuggestions:this.hideSuggestions}),(0,N.jsx)("label",{htmlFor:"delivery-information-postal-index",className:"msg-title",children:this.props.title}),""===this.state.value&&this.renderLocateMeButtonComponent({placement:this.getLocateMeButtonPosition(T.yf.default),showLocateMeText:!0}),this.state.isLoading&&(0,N.jsx)(c.g,{className:"locate-loading"}),!this.state.isLoading&&""!==this.state.value&&(0,N.jsx)("span",{"data-testid":"input-clear-icon",className:"icon inline-search-cancel-icon",onClick:this.onClearClick,role:"presentation",children:(0,N.jsx)(d(),{})})]})}),(0,N.jsx)("div",{id:"map-view-modal"}),this.state.captchaResponse&&(0,N.jsx)(ee.R,{onSubmit:()=>this.populateSuggestions(this.state.value,this.getInputElOffset(),te.T.SAVED_ADDRESS),captchaResponse:this.state.captchaResponse})]})}}se.contextType=I.K},"5a5afc411b33944d3a7e":(e,t,s)=>{"use strict";s.d(t,{R:()=>x});var i=s("e5e9f18c9a39805899ce"),o=s("69084d01d3449fc1bc27"),a=s("62360b9b8df4952ab993"),n=s("174811872339f1d02c40"),r=s.n(n),d=s("9302435e81c621e827fb");const c=["className","children"],l=e=>{let{className:t,children:s}=e,i=(0,a.Z)(e,c);return(0,d.jsx)("div",Object.assign({},i,{className:r()(t,"modal-body"),children:s}))},h=["link","className","isEnabled","children"],p=e=>{let{link:t="",className:s,isEnabled:i=!0,children:o}=e,n=(0,a.Z)(e,h);return(0,d.jsx)("a",Object.assign({href:t,className:r()(s,{disabled:!i})},n,{children:o}))},u=["className","size"],g=e=>{let{className:t,size:s="lg"}=e,i=(0,a.Z)(e,u);return(0,d.jsx)("div",{className:"modal-mobile-header",children:(0,d.jsx)(p,Object.assign({link:"#"},i,{className:r()("close-button",s,t)}))})};g.displayName="ModalCloseButton";const m=g,S=["className","children"],f=e=>{let{className:t,children:s}=e,i=(0,a.Z)(e,S);return(0,d.jsx)("p",Object.assign({},i,{className:r()(t,"modal-description"),children:s}))},v=["className","children"],b=e=>{let{className:t,children:s}=e,i=(0,a.Z)(e,v);return(0,d.jsx)("div",Object.assign({},i,{className:r()(t,"modal-header"),children:s}))},A=["isShown","maskClassNames"],C=e=>{let{isShown:t=!1,maskClassNames:s}=e,i=(0,a.Z)(e,A);return(0,d.jsx)("div",Object.assign({},i,{className:r()("modal-backdrop",s,{hide:!t})}))};C.displayName="ModalMask";const L=C,_=["ariaLabelledby","children","className","onClose","show"],E=e=>{let{ariaLabelledby:t,children:s,className:i,onClose:n,show:c}=e,l=(0,a.Z)(e,_);const h=e=>{"Escape"===e.key&&n(e)},p=e=>{null===e.target.closest(".modal-content")&&n(e)};return(0,o.useEffect)((()=>{const e=h;return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)})),(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(L,{"data-testid":"modal-overlay",isShown:c,onClick:p}),(0,d.jsx)("section",Object.assign({className:r()("react-modal new-modal modal",i,{hide:!c}),tabIndex:-1,role:"dialog","aria-labelledby":t,"aria-hidden":"true",onClick:p},l,{children:(0,d.jsx)("div",{className:"modal-dialog",children:(0,d.jsx)("div",{className:"modal-content",children:s})})}))]})};E.Body=l,E.Header=b,E.Description=f,E.CloseButton=m,E.Mask=L;const y=E,x=e=>(0,d.jsx)(y,{show:!0,onClose:()=>{},children:(0,d.jsx)(y.Body,{children:(0,d.jsx)(i.U,{className:"authentication__captcha",onSuccess:e.onSubmit,response:e.captchaResponse,pageType:"checkout",elementId:"captcha-container-address"})})})},"5bac396c86413df162b8":(e,t,s)=>{"use strict";s.d(t,{T:()=>o,v:()=>i});let i=function(e){return e.BIG="big",e.SMALL="small",e}({}),o=function(e){return e.AUTOCOMPLETE="autocomplete",e.SAVED_ADDRESS="saved address",e}({})},"8898b63d76f1fcc2092e":(e,t,s)=>{"use strict";s.d(t,{Z:()=>c});var i=s("62360b9b8df4952ab993"),o=s("69084d01d3449fc1bc27"),a=s("12be0f0e9e2c7751d613"),n=s("e6d8e6e4db446a4649db"),r=s("9302435e81c621e827fb");const d=["forwardedRef"];const c=function(e,t){class s extends o.Component{constructor(){super(...arguments),this.state={loading:!0,appConfig:void 0}}componentDidMount(){a.ZP.loadAddressServiceConfig(this.props.appConfig).then((e=>{const t=Object.assign({},this.props.appConfig,{address_config:e});this.setState({appConfig:t,loading:!1})}))}render(){if(this.state.loading)return null;{const s=this.props,{forwardedRef:o}=s,a=(0,i.Z)(s,d);return(0,r.jsx)(n.d,{boundaryId:t||"locationComponent",children:(0,r.jsx)(e,Object.assign({},a,{ref:o,appConfig:this.state.appConfig}))})}}}const c=o.forwardRef(((e,t)=>(0,r.jsx)(s,Object.assign({},e,{forwardedRef:t}))));return c.displayName="LocationConfigLoader",c}},"6fd2852d6f9220b4ea44":(e,t,s)=>{"use strict";s.d(t,{X:()=>i});let i=function(e){return e.EMPTY_INPUT="EMPTY_INPUT",e.INVALID_ADDRESS_NOT_FOUND="INVALID_ADDRESS_NOT_FOUND",e.INVALID_MAP_ADDRESS_NOT_FOUND="INVALID_MAP_ADDRESS_NOT_FOUND",e.INVALID_ADDRESS_COUNTRY_NOT_SUPPORTED="INVALID_ADDRESS_COUNTRY_NOT_SUPPORTED",e.INCOMPLETE_ADDRESS_BUILDING_AND_STREET="INCOMPLETE_ADDRESS_BUILDING_AND_STREET",e.INCOMPLETE_ADDRESS_BUILDING="INCOMPLETE_ADDRESS_BUILDING",e.INCOMPLETE_ADDRESS_STREET="INCOMPLETE_ADDRESS_STREET",e.INCOMPLETE_ADDRESS_POSTCODE="INCOMPLETE_ADDRESS_POSTCODE",e.NO_GEOLOCATION="NO_GEOLOCATION",e.INVALID_ADDRESS="INVALID_ADDRESS",e.ADDRESS_NOT_DELIVERABLE="ADDRESS_NOT_DELIVERABLE",e.NA="N/A",e}({})},e6d8e6e4db446a4649db:(e,t,s)=>{"use strict";s.d(t,{d:()=>d});var i=s("62360b9b8df4952ab993"),o=s("ac129530af3fa799bed9"),a=s("b7713ec20a37c71a6f98"),n=s("9302435e81c621e827fb");const r=["children","beforeCapture","boundaryId"],d=e=>{let{children:t,beforeCapture:s,boundaryId:d}=e,c=(0,i.Z)(e,r);return(0,n.jsx)(a.SV,Object.assign({beforeCapture:(e,t,i)=>{e.setTags({boundaryId:d,withErrorBoundary:!0,serviceName:"errorTracking",networkType:(0,o._)(),screenSize:(0,o.t)()}),null==s||s(e,t,i)}},c,{children:t}))}},"6602d2ed10acb4d71eb7":(e,t,s)=>{"use strict";s.d(t,{K:()=>i});const i=(0,s("69084d01d3449fc1bc27").createContext)({})},"3ff5230752f8be307b07":(e,t,s)=>{"use strict";s.d(t,{H:()=>a});s("69084d01d3449fc1bc27");var i=s("6602d2ed10acb4d71eb7"),o=s("9302435e81c621e827fb");const a=e=>{let{children:t}=e;return(0,o.jsx)(i.K.Provider,{value:{},children:t})};a.displayName="LocationExperimentsProvider"},f799360550622a669e28:(e,t,s)=>{"use strict";s.d(t,{Pc:()=>T});var i=s("54bdd803dcbe7795ce01"),o=s.n(i),a=s("8f58e784196e6568c885"),n=s.n(a),r=s("aae2c6e838ecaa2edb3b"),d=s("622f20ebd7ebd0596b4d"),c=s("d7f2db0229e7c7df3214"),l=s("0e8400aef1ea36fada43"),h=s("69084d01d3449fc1bc27"),p=s("2e0796c118320b51c6e6"),u=s("bd11212dd200c13dd4e4"),g=s("b48d419be3e1903edcd4"),m=s("e616c1d2506323e40c02"),S=s("fac2effa2380bfd3e70d"),f=s("12be0f0e9e2c7751d613"),v=s("f481ef00e50d282f38a9"),b=s("cf8b9eba67b9e579aba1"),A=s("8898b63d76f1fcc2092e"),C=s("6fd2852d6f9220b4ea44"),L=s("3ff5230752f8be307b07"),_=s("a7f44a4d9a149fde3658"),E=s("549640134fdb6d7e36d7"),y=s("9302435e81c621e827fb");class x extends h.PureComponent{static getDerivedStateFromProps(e){return{showSuggestions:e.showSuggestions}}constructor(e){super(e),this.addressChangeTracker=void 0,this.alwaysShowMapFlag=void 0,this.inputNode=void 0,this.inputNodeModal=void 0,this.inputComponentRef=void 0,this.translations=void 0,this.latestSubmittedAddress=void 0,this.locationModel=void 0,this.googleMapScriptLoader=void 0,this.gtmLocationService=void 0,this.cachedAddress=void 0,this.trackingState=void 0,this.Overlay=void 0,this.isAutocompleteExperimentEnabled=void 0,this.handleDropdownVisibility=()=>{const{showMap:e}=this.state,{showMapView:t}=this.props,s=document.querySelector(".bds-c-modal__dialog-window");null!=s&&s.style&&(s.style.visibility=e||t?"hidden":"visible")},this.isEditMode=()=>this.props.isWhereComponent&&(0,_.J)(this.props.isWhereComponent),this.geocodeHandler=e=>{this.setState({geocodeAddress:e})},this.onSuggestionListSelected=e=>{var t,s;null===(t=(s=this.props).onSuggestionListSelected)||void 0===t||t.call(s,e)},this.Overlay=(0,r.ZP)({resolved:{},chunkName:()=>"map-modal-overlay",isReady(e){const t=this.resolve(e);return!0===this.resolved[t]&&!!s.m[t]},importAsync:()=>s.e(43267).then(s.bind(s,"a11cd05ed5b4306a5150")),requireAsync(e){const t=this.resolve(e);return this.resolved[t]=!1,this.importAsync(e).then((e=>(this.resolved[t]=!0,e)))},requireSync(e){const t=this.resolve(e);return s(t)},resolve(){return"a11cd05ed5b4306a5150"}}),this.inputNode=h.createRef(),this.inputNodeModal=h.createRef(),this.inputComponentRef=h.createRef(),this.alwaysShowMapFlag=n()(e.appConfig,"features.flags.always-map","N/A"),this.addressChangeTracker=e.locationService.getAddressChangeTracker(),this.locationModel=e.locationService.getModel(),this.translations=e.translations,this.trackingState=E.B.NA,this.state={hasLocationPermissionError:!1,showMap:e.showMapView||!1,selectedAddress:this.locationModel?new u.C(this.locationModel):null,showSuggestions:!1,expeditionType:e.expeditionType||d.qE.DELIVERY,errorMessage:"",isError:!1,noAddressOpenMap:!1,enableButton:!1,geocodeAddress:null},this.cachedAddress=this.state.selectedAddress?this.state.selectedAddress:null,this.latestSubmittedAddress=this.state.selectedAddress,this.showMap=this.showMap.bind(this),this.closeMap=this.closeMap.bind(this),this.hideSuggestions=this.hideSuggestions.bind(this),this.onChange=this.onChange.bind(this),this.onInputTouch=this.onInputTouch.bind(this),this.submitGeocode=this.submitGeocode.bind(this),this.submitAddress=this.submitAddress.bind(this),this.displayError=this.displayError.bind(this),this.geocode=this.geocode.bind(this),this.hideTooltip=this.hideTooltip.bind(this),this.handleDropdownVisibility=this.handleDropdownVisibility.bind(this),this.validateUserAddressLocally=this.validateUserAddressLocally.bind(this),this.getErrorTranslation=this.getErrorTranslation.bind(this),this.googleMapScriptLoader=(0,S.h)(e.appConfig),this.gtmLocationService=e.locationService.getGTMLocationService(),this.trackEventsOnSubmitClick=this.trackEventsOnSubmitClick.bind(this),this.setSubmitTrackingState=this.setSubmitTrackingState.bind(this),this.handleInputAddressSubmit=this.handleInputAddressSubmit.bind(this),this.handleLocateMeFail=this.handleLocateMeFail.bind(this),this.isAutocompleteExperimentEnabled=!!this.props.autocompleteExperiment}componentDidMount(){this.handleDropdownVisibility(),this.setupEventListener(),this.state.selectedAddress&&this.addressChangeTracker.setLastStepType("RestaurantsSearchButton")}componentWillUnmount(){this.handleDropdownVisibility()}componentDidUpdate(e,t){var s,i;if(t.showMap===this.state.showMap&&e.showMapView===this.props.showMapView||this.handleDropdownVisibility(),this.state.noAddressOpenMap&&null!==(s=this.inputNode)&&void 0!==s&&null!==(i=s.current)&&void 0!==i&&i.value){const e={trigger:{isUpdate:!1,type:"Manual"},expeditionType:this.state.expeditionType};this.submitGeocode(e.trigger,e.expeditionType,!0)}}setupEventListener(){this.props.locationService.getEventLord().on(this.props.geoCodeAddressEventName||"geocode:address",(e=>{this.handleInputAddressSubmit(e.trigger,e.expeditionType)})),this.props.locationService.getEventLord().on("address:changed",(e=>{this.setState({selectedAddress:new u.C(e)}),this.props.locationService.setModel(new u.C(e)),this.locationModel=this.props.locationService.getModel(),this.props.locationService.getEventLord().emit("address:saved")})),this.props.vendorCart&&this.props.locationService.getEventLord().on(this.props.changeExpeditionTypeEventName||"change:expedition_type",(()=>{this.setState({expeditionType:this.props.vendorCart.get("expedition_type")})}));const e=document.getElementById("location-search-button");e&&e.addEventListener("click",(()=>{const e=this.locationModel?new u.C(this.locationModel):null;this.setState({selectedAddress:e})}))}handleInputAddressSubmit(e,t){const s=this.inputNode.current?this.inputNode.current.value:"";s||this.setState({noAddressOpenMap:!0}),this.trackingState=s?this.trackingState:E.B.ERRORED,this.trackEventsOnSubmitClick(),this.submitGeocode(e,t)}setSubmitTrackingState(e){this.trackingState=e}trackEventsOnSubmitClick(){switch(this.trackingState){case E.B.CLICKED:this.gtmLocationService.initializeLocationAttemptedTracking("RestaurantsSearchButton"),this.gtmLocationService.trackLocationAttempted(this.locationModel);break;case E.B.ERRORED:this.gtmLocationService.trackLocationClicked(this.locationModel,this.props.vendor,"NA","RestaurantsSearchButton");break;case E.B.ATTEMPTED:case E.B.SUBMITTED:break;case E.B.NA:default:this.gtmLocationService.trackLocationClicked(this.locationModel,this.props.vendor,"NA","RestaurantsSearchButton"),this.gtmLocationService.initializeLocationAttemptedTracking("RestaurantsSearchButton"),this.gtmLocationService.trackLocationAttempted(this.locationModel)}}hideSuggestions(){this.setState({showSuggestions:!1})}showMap(){this.setState({showMap:!0})}closeMap(){(this.state.showMap||this.props.onCloseMap)&&(this.setState({showMap:!1,hasLocationPermissionError:!1}),this.props.onCloseMap&&this.props.onCloseMap())}displayError(e,t){void 0===t&&(t="");const s=""!==t?t:this.getErrorTranslation(e);this.setState({errorMessage:s,isError:!0}),this.props.locationService.getEventLord().emit("fullAddressSearchView:error"),this.props.locationService.getEventLord().emit("location-input-component:displayError",e)}getErrorTranslation(e){const t=this.translations.error_invalid_address_not_found_experiment;switch(e){case C.X.INVALID_MAP_ADDRESS_NOT_FOUND:return this.translations.error_invalid_address_not_found;case C.X.INVALID_ADDRESS_NOT_FOUND:case C.X.INVALID_ADDRESS:return t;case C.X.EMPTY_INPUT:return this.translations.error_empty_input;case C.X.INVALID_ADDRESS_COUNTRY_NOT_SUPPORTED:return this.translations.error_invalid_address_country_not_supported;case C.X.INCOMPLETE_ADDRESS_POSTCODE:return this.translations.error_incomplete_address_postcode;case C.X.INCOMPLETE_ADDRESS_STREET:return this.translations.error_incomplete_address_street;case C.X.INCOMPLETE_ADDRESS_BUILDING:return this.translations.error_incomplete_address_building;case C.X.INCOMPLETE_ADDRESS_BUILDING_AND_STREET:return this.translations.error_incomplete_address_building_street;case C.X.NO_GEOLOCATION:return this.translations.error_no_geolocation;default:return c.k.error({error:new Error(e),message:"FullAddressInputSearchError:",extraInfo:{error:e}}),t}}hideTooltip(){this.setState({errorMessage:"",isError:!1})}handleAddressSubmission(e){var t,s;const i=new u.C(Object.assign({},e,{expedition_type:this.state.expeditionType}));this.props.onChange&&this.props.onChange(i),this.props.locationService.getEventLord().emit("address:changed",e),this.props.locationService.getEventLord().emit(this.props.fullAddressSearchEventName||"full-address-search:submit",i),null===(t=(s=this.props).onModalSubmit)||void 0===t||t.call(s,e)}submitAddress(e,t){this.closeMap(),this.setState({selectedAddress:e}),t&&this.trackSubmit(t,e),this.addressChangeTracker.setLastStepType(null),this.handleAddressSubmission(e)}onInputTouch(){this.setState({selectedAddress:null})}setLoadingState(e){this.inputComponentRef.current&&this.inputComponentRef.current.handleSetLoadingStateEvent&&this.inputComponentRef.current.handleSetLoadingStateEvent(e)}async submitGeocode(e,t,s){s&&this.setState({noAddressOpenMap:!1}),this.hideSuggestions();const i=this.state.selectedAddress,a=i&&i.formatted_customer_address?i.formatted_customer_address:this.inputNode.current?this.inputNode.current.value:"",n=i?i.place_id:void 0;if(a){t&&await new Promise((e=>{this.setState({expeditionType:t},e)})),this.setLoadingState(!0);const{isValid:s,error:r}=this.validateUserAddressLocally();if(!s){this.displayError(r);const t=this.trackingState===E.B.NA?"RestaurantsSearchButton":e.type;return this.gtmLocationService.trackLocationError("INVALID_ADDRESS",t,this.state.selectedAddress),void this.setLoadingState(!1)}i&&i.id||i&&o()(i,this.cachedAddress)?(this.hideTooltip(),this.setLoadingState(!1),this.parseGeocodedAddress(e,i)):this.geocode(a,n).then((e=>this.isAutocompleteExperimentEnabled&&e.latitude&&e.longitude?(0,m.O)(f.ZP.getInstance(),{latitude:e.latitude,longitude:e.longitude}):e)).then((t=>{if(this.setLoadingState(!1),!t)return this.displayError(C.X.INVALID_ADDRESS_NOT_FOUND),void this.gtmLocationService.trackLocationError("INVALID_ADDRESS",e.type,this.state.selectedAddress);this.hideTooltip(),this.setState({selectedAddress:t}),this.parseGeocodedAddress(e,t)})).catch((()=>{this.setLoadingState(!1),this.gtmLocationService.trackLocationError("INVALID_ADDRESS",e.type,this.state.selectedAddress),this.displayError(C.X.INVALID_ADDRESS_NOT_FOUND)}))}else{this.displayError(C.X.EMPTY_INPUT);const t=this.trackingState===E.B.ERRORED?"RestaurantsSearchButton":e.type;this.gtmLocationService.trackLocationError("EMPTY_INPUT",t,this.state.selectedAddress)}}async geocode(e,t){if(this.state.geocodeAddress&&this.state.selectedAddress===this.state.geocodeAddress)return this.state.geocodeAddress;try{return await(t?g.i.getInstance().getDetails({id:t}):g.i.getInstance().getGeocode({address:e}))}catch(e){return Promise.reject(e)}}trackSubmit(e,t){let s=!1;this.props.trackUpdate&&this.latestSubmittedAddress&&(s=this.latestSubmittedAddress.place_id!==t.place_id),this.addressChangeTracker.setSubmitTrigger(Object.assign({},e,{isUpdate:s})),this.latestSubmittedAddress=t,this.addressChangeTracker.track(t)}parseGeocodedAddress(e,t){var s;this.addressChangeTracker.setSubmitTrigger(e);let i=!1;switch(!0){case!!t.id:case this.cachedAddress&&this.cachedAddress.place_id===t.place_id:i=!1;break;case"yes"===this.alwaysShowMapFlag:case!f.ZP.getInstance().isAddressValid(t,this.alwaysShowMapFlag):i=!0}if(this.props.isWhereComponent&&(0,_.J)(this.props.isWhereComponent)&&"home"!==(null===(s=this.props.locationService.getTagManager())||void 0===s?void 0:s.pageType)){const e=!f.ZP.getInstance().isAddressValid(t,this.alwaysShowMapFlag);this.setState({enableButton:!e}),this.gtmLocationService.initializeLocationAttemptedTracking("Search"),this.gtmLocationService.trackLocationAttempted(this.props.locationService.getModel(),this.props.vendor,v.P.NEW_ADDRESS),this.showMap()}else i?this.showMap():this.submitAddress(t,e)}validateUserAddressLocally(){const e=this.inputNode.current&&this.inputNode.current.value;return e?this.isValidUserInput(e,this.props.appConfig)?{isValid:!0}:{isValid:!1,error:C.X.INCOMPLETE_ADDRESS_POSTCODE}:{isValid:!1,error:C.X.EMPTY_INPUT}}isValidUserInput(e,t){const s=n()(t,"address_config.valid_address_input");return null!==e.trim().match(s)}onChange(e,t){void 0===t&&(t=!1),this.setState({selectedAddress:e},(()=>{if(this.props.autoSubmit&&!t){const e={trigger:{isUpdate:!1,type:"Manual"},expeditionType:this.state.expeditionType};this.submitGeocode(e.trigger,e.expeditionType)}})),this.hideTooltip()}handleLocateMeFail(){this.setState({showMap:!0,hasLocationPermissionError:!0})}render(){const e=this.translations.input_label_experiment,t=this.translations.location_input_placeholder||"";return(0,y.jsxs)(L.H,{gtmLocationService:this.gtmLocationService,locationModel:this.locationModel,locationConfig:this.props.appConfig,children:[" ",(0,y.jsx)(l.$,{translation:Object.assign({},this.translations),children:(0,y.jsxs)(h.Fragment,{children:[this.Overlay&&(this.state.showMap||this.props.showMapView)&&(0,y.jsx)(this.Overlay,{hideAddressList:this.props.hideAddressList,enableButton:this.state.enableButton,isWhereComponent:this.props.isWhereComponent,onSubmitAddress:this.props.onSubmitAddress,disableInitialMessage:this.state.hasLocationPermissionError,hasLocationPermissionError:this.state.hasLocationPermissionError,onClose:this.closeMap,googleMapScriptLoader:this.googleMapScriptLoader,appConfig:this.props.appConfig,elementId:"map-id",model:this.props.editedAddress&&this.isEditMode()?this.props.editedAddress:this.state.selectedAddress,selectedAddress:this.props.editedAddress&&this.isEditMode()?this.props.editedAddress:this.state.selectedAddress,clearEditMode:this.props.clearEditMode,isEditMode:this.props.editedAddress&&this.isEditMode(),savedAddresses:this.props.savedAddresses,gtmLocationService:this.gtmLocationService,expeditionType:this.state.expeditionType,focusOnRender:!1,showSavedAddress:!0,showSuggestions:this.state.showSuggestions,addressChangeTracker:this.addressChangeTracker,inputRef:this.inputNodeModal,errorTranslator:this.getErrorTranslation,hiddenError:this.hideTooltip,onSubmit:this.submitAddress,placeholder:t,title:e,modalTitle:this.translations.location_map_title,mapPinTitle:this.translations.map_tooltip,mapSubmitTitle:this.translations.map_submit_btn,locationService:this.props.locationService,vendor:this.props.vendor,disableValidation:this.props.disableAutoInputValidation,translations:this.translations,onMapClose:this.closeMap}),(0,y.jsx)(b.z,{isWhereComponent:this.props.isWhereComponent,fillInputSearch:this.props.fillInputSearch,autoSubmit:this.props.autoSubmit,ref:this.inputComponentRef,inputRef:this.inputNode,model:this.state.selectedAddress,appConfig:this.props.appConfig,gtmLocationService:this.gtmLocationService,expeditionType:this.state.expeditionType,focusOnRender:!1,showSavedAddress:this.props.showSavedAddress,showSuggestions:this.state.showSuggestions,onLocateMeFail:this.handleLocateMeFail,selectedAddress:this.state.selectedAddress,addressChangeTracker:this.addressChangeTracker,onChange:this.onChange,onTouched:this.onInputTouch,displayError:this.displayError,hiddenError:this.hideTooltip,placeholder:this.props.showPlaceholder?t:"",title:e,inputSize:this.props.inputSize,locationService:this.props.locationService,toolTipMsg:this.state.errorMessage,onCancelSearch:this.props.onCancelSearch,disableAutoValidation:this.props.disableAutoInputValidation,vendor:this.props.vendor,trackInputState:this.setSubmitTrackingState,translations:this.translations,isMapOpen:!1,noAddressOpenMap:this.state.noAddressOpenMap,onSuggestionListChanged:this.props.onSuggestionListChanged,isManuallyTypedAddress:!0,onMapClose:this.closeMap,geocodeHandler:this.geocodeHandler,onSuggestionListSelected:this.onSuggestionListSelected})]})})]})}}x.defaultProps={autocompleteExperiment:!0};const T=(0,A.Z)(x,"LocationInput"),N=e=>{const t=e.wrapper?e.wrapper:document.getElementById("address-search-container");return(0,p.render)((0,y.jsx)(T,Object.assign({},e,{onSubmitAddress:e.onSubmitAddress,savedAddresses:e.savedAddresses,clearEditMode:e.clearEditMode,editedAddress:e.editedAddress,isWhereComponent:e.isWhereComponent,fillInputSearch:e.fillInputSearch,locationService:e.locationService,appConfig:e.appConfig,tooltipPlacement:e.tooltipPlacement,googleMapScriptLoader:e.googleMapScriptLoader,expeditionType:e.expeditionType,vendorCart:e.vendorCart,focusOnRender:e.focusOnRender,spinnerHTMLElement:e.spinnerHTMLElement,showSavedAddress:e.showSavedAddress,suggestionsContainer:e.suggestionsContainer,showSuggestions:e.showSuggestions,onChange:e.onChange,showPlaceholder:e.showPlaceholder})),t)}},a7f44a4d9a149fde3658:(e,t,s)=>{"use strict";s.d(t,{J:()=>o});var i=s("12be0f0e9e2c7751d613");const o=function(e,t){void 0===t&&(t=!1);const s=""!==i.ZP.getInstance().getCustomerId();return t?s:s&&e}},"568ecdc81696e6199594":(e,t,s)=>{"use strict";s.d(t,{rd:()=>i,rk:()=>o,yf:()=>a});let i=function(e){return e.disabled="disabled",e.loading="loading",e.centerChanged="",e.null="",e}({}),o=function(e){return e.ZOOM_IN="zoom_in",e.ZOOM_OUT="zoom_out",e}({}),a=function(e){return e.default="default",e.modalMap="modalMap",e}({})},"549640134fdb6d7e36d7":(e,t,s)=>{"use strict";s.d(t,{B:()=>i});let i=function(e){return e.CLICKED="Clicked",e.ATTEMPTED="Attempted",e.SUBMITTED="Submitted",e.ERRORED="Errored",e.NA="NA",e}({})},"1c2f52c061810467b454":(e,t,s)=>{"use strict";s.d(t,{R:()=>O,v:()=>w});var i=s("25f871b926a308f9cf03"),o=s.n(i),a=s("4251de03d478be1be4fa"),n=s.n(a),r=s("b885315ea9edeabb2c2d"),d=s.n(r),c=s("3bf46fb44d8d9872d5db"),l=s.n(c),h=s("1afafb1030638799873e"),p=s.n(h),u=s("6c98f6eb5d8c8e24aa4d"),g=s.n(u),m=s("4bc8a8a5e7e314d8175d"),S=s.n(m),f=s("b7daca8bbc8942ed46a0"),v=s.n(f),b=s("d8b9c951ab0e2d9eeae4"),A=s.n(b),C=s("02c3e1412ab666c08363"),L=s.n(C),_=s("33290a3606c3bcdb2aa0"),E=s.n(_),y=s("4d267083d61b8f29a1d3"),x=s.n(y),T=s("94217eecef624954b619"),N=s("ef7f39a531ad1aecc167"),M=s("9302435e81c621e827fb");const w=(e,t)=>{const s=null!=t?t:"interaction-primary";switch((0,N.Fz)(e)){case T._.HOME:return(0,M.jsx)(l(),{fill:s});case T._.COMPANY:case T._.WORK:return(0,M.jsx)(E(),{fill:s});case T._.PARTNER:return(0,M.jsx)(n(),{fill:s});case T._.OTHER:default:return(0,M.jsx)(g(),{fill:s})}},O=(e,t,s)=>{const i=null!=t?t:"interaction-primary";switch((0,N.Fz)(e)){case T._.HOME:return s?(0,M.jsx)(S(),{fill:i}):(0,M.jsx)(p(),{"data-testid":"home-label"});case T._.COMPANY:case T._.WORK:return s?(0,M.jsx)(A(),{fill:i}):(0,M.jsx)(x(),{"data-testid":"work-label"});case T._.PARTNER:return s?(0,M.jsx)(v(),{fill:i}):(0,M.jsx)(d(),{"data-testid":"partner-label"});case T._.OTHER:default:return s?(0,M.jsx)(L(),{fill:i}):(0,M.jsx)(o(),{"data-testid":"other-label"})}}},ef7f39a531ad1aecc167:(e,t,s)=>{"use strict";s.d(t,{Aq:()=>n,FE:()=>c,Fz:()=>a,Kt:()=>d,id:()=>r});var i=s("92dfcc2420a73bb8a53b"),o=s("94217eecef624954b619");const a=e=>e&&"number"==typeof e||0===e?e.toString():e,n=(e,t,s,i)=>e.filter((e=>t===a(e.type)&&i&&i===e.label&&e.id!==s)).length>0,r=(e,t)=>{switch(e){case o._.HOME:return"Home";case o._.COMPANY:return"Company";case o._.WORK:return"Work";case o._.PARTNER:return"Partner";case o._.OTHER:default:return t}},d=e=>{const{NEXTGEN_HOME:t,NEXTGEN_COMPANY:s,NEXTGEN_WORK:o,address_label_partner:a,address_label_new_address:n}=i.w;return{NEXTGEN_HOME:e(t),NEXTGEN_COMPANY:"NEXTGEN_company"===e("NEXTGEN_company")?e(s):e("NEXTGEN_company"),NEXTGEN_WORK:e(o),address_label_partner:e(a),address_label_new_address:e(n)}},c=(e,t)=>{switch(a(t.type)){case o._.HOME:return e.NEXTGEN_HOME;case o._.COMPANY:return e.NEXTGEN_COMPANY;case o._.WORK:return e.NEXTGEN_WORK;case o._.PARTNER:return e.address_label_partner;case o._.OTHER:return t.label;default:return e.address_label_new_address}}},e616c1d2506323e40c02:(e,t,s)=>{"use strict";async function i(e,t){let{latitude:s,longitude:i}=t;return await e.getGeocoderV2Service().getReverse({lat:s,lng:i})}s.d(t,{O:()=>i})},"3ea3cb108c28f44a15b3":(e,t,s)=>{"use strict";s.d(t,{g:()=>n});var i=s("174811872339f1d02c40"),o=s.n(i),a=s("9302435e81c621e827fb");const n=e=>{let{className:t}=e;return(0,a.jsxs)("div",{"data-testid":"loading-dots",className:o()("calcul-animation",t),children:[(0,a.jsx)("span",{className:"dot"}),(0,a.jsx)("span",{className:"dot"}),(0,a.jsx)("span",{className:"dot"})]})}},"312ccabcc38b2daf7e8c":(e,t,s)=>{"use strict";s.r(t),s.d(t,{LocationPicker:()=>Pe,locationPickerWrapper:()=>o});var i=s("9ad50678fcf59a0f6543");const o="where-wrapper";var a=s("357b5e421c562f4d34f8"),n=s.n(a),r=s("775358d40899413d6f88"),d=s("b6c652ac9318741b9db2"),c=s("e311b6db2cc5f16c07bc"),l=s.n(c),h=s("79633f5be88e4568f972"),p=s.n(h),u=s("545a53d22bf405183074"),g=s("9f3f340b65c456465766"),m=s.n(g),S=s("622f20ebd7ebd0596b4d"),f=s("b7713ec20a37c71a6f98"),v=s("69084d01d3449fc1bc27"),b=s("ac129530af3fa799bed9"),A=s("9302435e81c621e827fb");const C=e=>{let{fallback:t,onError:s,tags:i,context:o,beforeCapture:a,children:n}=e;return(0,A.jsx)(f.SV,{fallback:null!=t?t:void 0,onError:s,beforeCapture:(e,t,s)=>{if(e.setTags(Object.assign({networkType:(0,b._)(),screenSize:(0,b.t)()},i)),o){const[t,s]=o;e.setContext(t,s)}null==a||a(e,t,s)},children:n})};var L=s("0e8400aef1ea36fada43"),_=s("4d4238b3f32bba880178"),E=s("174811872339f1d02c40"),y=s.n(E),x=s("2e0796c118320b51c6e6"),T=s("787980cc545b28bdd6fd"),N=s("12be0f0e9e2c7751d613"),M=s("f481ef00e50d282f38a9"),w=s("e2ba54487d3e9f01ee4a"),O=s("5a5afc411b33944d3a7e"),I=s("8898b63d76f1fcc2092e"),D=s("d7f2db0229e7c7df3214"),j=s("94217eecef624954b619"),k=s("58f9fd2015b2625e1755"),R=s("eddd4ca81f1144531f7b"),P=s.n(R),F=s("bdc216a4d248b845f00c");const V=()=>(0,A.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",width:24,height:24,children:[(0,A.jsx)("defs",{children:(0,A.jsx)("path",{id:"ic-arrow-tail-back",d:"M3.81 11.5H22v1H3.81L10 19.3l-.73.7L2 12l7.27-8 .73.7-6.19 6.8z"})}),(0,A.jsx)("use",{fillRule:"nonzero",xlinkHref:"#ic-arrow-tail-back"})]}),B=()=>(0,A.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",children:(0,A.jsxs)("g",{fill:"none",fillRule:"evenodd",children:[(0,A.jsx)("path",{fill:"#707070",fillRule:"nonzero",d:"M18.5,2 C18.7454599,2 18.9496084,2.17687516 18.9919443,2.41012437 L19,2.5 L19,21.5 C19,21.7454599 18.8231249,21.9496084 18.5898756,21.9919443 L18.5,22 L13.5,22 C13.2545401,22 13.0503916,21.8231249 13.0080557,21.5898756 L13,21.5 L13,18 L11,18 L11,21.5 C11,21.7454599 10.8231248,21.9496084 10.5898756,21.9919443 L10.5,22 L5.5,22 C5.25454011,22 5.05039163,21.8231249 5.00805567,21.5898756 L5,21.5 L5,2.5 C5,2.25454011 5.17687516,2.05039163 5.41012437,2.00805567 L5.5,2 L18.5,2 Z M17,4 L7,4 L7,20 L9,20 L9,16.5 C9,16.2545401 9.17687516,16.0503916 9.41012437,16.0080557 L9.5,16 L14.5,16 C14.7454599,16 14.9496084,16.1768751 14.9919443,16.4101244 L15,16.5 L15,20 L17,20 L17,4 Z"}),(0,A.jsx)("path",{fill:"#707070",fillRule:"nonzero",d:"M10.5 11C10.7761424 11 11 11.2238576 11 11.5L11 11.5 11 12.5C11 12.7761424 10.7761424 13 10.5 13L10.5 13 9.5 13C9.22385763 13 9 12.7761424 9 12.5L9 12.5 9 11.5C9 11.2238576 9.22385763 11 9.5 11L9.5 11 10.5 11zM14.5 11C14.7761424 11 15 11.2238576 15 11.5L15 11.5 15 12.5C15 12.7761424 14.7761424 13 14.5 13L14.5 13 13.5 13C13.2238576 13 13 12.7761424 13 12.5L13 12.5 13 11.5C13 11.2238576 13.2238576 11 13.5 11L13.5 11 14.5 11zM10.5 7C10.7761424 7 11 7.22385763 11 7.5L11 7.5 11 8.5C11 8.77614237 10.7761424 9 10.5 9L10.5 9 9.5 9C9.22385763 9 9 8.77614237 9 8.5L9 8.5 9 7.5C9 7.22385763 9.22385763 7 9.5 7L9.5 7 10.5 7zM14.5 7C14.7761424 7 15 7.22385763 15 7.5L15 7.5 15 8.5C15 8.77614237 14.7761424 9 14.5 9L14.5 9 13.5 9C13.2238576 9 13 8.77614237 13 8.5L13 8.5 13 7.5C13 7.22385763 13.2238576 7 13.5 7L13.5 7 14.5 7z"})]})}),U=e=>{let{addressCollection:t,isMView:s,locationService:i,onAddressChange:o,onCancelSearch:a}=e;return(0,A.jsxs)(A.Fragment,{children:[s&&(0,A.jsx)("p",{className:"corporate-switch-to-personal",children:(0,A.jsx)("span",{role:"button",tabIndex:0,onKeyDown:a,onClick:a,className:"cancel-search",children:(0,A.jsx)(V,{})})}),(0,A.jsx)("ul",{className:"corporate-address-option-list","data-testid":"location-dropdown__option",children:t&&t.map((e=>{var t;return(0,A.jsx)("li",{"data-testid":"location-dropdown__option-item",children:(0,A.jsx)("div",{role:"button",tabIndex:0,onKeyDown:()=>o(e),onClick:()=>o(e),"data-testid":"location-button-item",children:(0,A.jsxs)("label",{className:"radio-box",children:[(0,A.jsx)(P(),{label:"",id:null===(t=e.id)||void 0===t?void 0:t.toString(),defaultChecked:(0,F.Sh)(i.getModel(),e,i.getAddressFormatter().getFormMappings())}),(0,A.jsx)("i",{className:"office-thick-icon icon",children:(0,A.jsx)(B,{})}),(0,A.jsx)("span",{className:"formatted-address",children:i.getFormattedAddress(i.getLocationModelDataFromLocationData(e))})]})})},e.id)}))})]})};var G=s("3d76b5ef4afae4f8a944"),W=s.n(G),H=s("a7dceeac37519cfc1804"),K=s("92dfcc2420a73bb8a53b");const X=e=>{let{addressCollection:t,listDisplayed:s,locationService:i,onAddressChange:o,selectedAddress:a,toggleLocationSelection:n}=e;const[r,d]=(0,v.useState)({}),c=(0,H.T)(),{input_label_experiment:l}=K.w;(0,v.useEffect)((()=>{const e=document.querySelector(".location-toggle-btn"),t=()=>{if(e){let t=.9*e.clientWidth;const s=window.innerWidth-32;t>s&&(t=.9*s),d({width:t})}};return t(),window.addEventListener("resize",t),()=>{window.removeEventListener("resize",t)}}),[]);const h=y()("location-toggle-btn",{active:s}),p=c(l);return(0,A.jsxs)("div",{className:"location-dropdown","data-testid":"location-dropdown__select",children:[(0,A.jsxs)("button",{className:h,onClick:n,"data-testid":"toggle-button",children:[(0,A.jsx)("span",{style:r,children:a||p}),(0,A.jsx)(W(),{className:"header-order-button-arrow"})]}),s&&(0,A.jsx)("ul",{className:"location-list","data-testid":"location-dropdown__select-list",children:t&&t.map((e=>(0,A.jsx)("li",{"data-testid":"location-dropdown__select-list-item",children:(0,A.jsx)("div",{role:"button",tabIndex:0,onClick:()=>o(e),onKeyDown:()=>o(e),"data-testid":"location-dropdown__select-list-change",children:i.getFormattedAddress(i.getLocationModelDataFromLocationData(e))})},e.id)))})]})};class z extends v.PureComponent{constructor(e){super(e),this.gtmLocationService=void 0,this.fetchAddresses=async()=>{const e=(0,k.Z)(this.props.locationService.getAddressService(),this.props.locationService.getCustomerId());try{const t=await e();this.setState({captchaResponse:null});if(t.some((e=>e.type===j._.COMPANY))||!(this.state.counter<=2)){const e=t.filter((e=>e.corporate_reference_id));return 0===e.length&&D.k.error({error:new Error,message:"Empty address for non-flexi user",extraInfo:{boundaryId:"corporate_admin-data-location"}}),void this.setState({addressCollection:e})}this.setState({counter:this.state.counter+1},(()=>{this.fetchAddresses()}))}catch(e){var t;const s=N.ZP.getInstance().getLocationXhrService(),i=(null==e||null===(t=e.response)||void 0===t?void 0:t.data)||e;s.isAppIdExist(e)&&this.setState({captchaResponse:i})}},this.toggleLocationSelection=()=>{this.setState({listDisplayed:!this.state.listDisplayed})},this.onAddressChange=e=>{e.corporate_reference_id||(e.corporate_reference_id=e.id);const t=Object.assign({},e,{isCompanyAddress:!0,formatted_customer_address:this.props.locationService.getFormattedAddress(e)});this.props.locationService.setFromFormat(t);const s=this.props.locationService.getModel();this.isAddressChanged(s.formatted_customer_address)&&(s.expedition_type=this.props.expeditionType,this.gtmLocationService.trackCorporateLocationClick(s),"function"==typeof this.props.onChange&&this.props.onChange(s),this.props.locationService.getEventLord().emit("address:changed",s),this.props.locationService.getEventLord().emit(this.props.fullAddressSearchEventName||"full-address-search:submit",s),this.toggleLocationSelection())},this.isAddressChanged=e=>null!==this.props.selectedAddress&&this.props.selectedAddress!==e,this.state={listDisplayed:!1,formMappings:e.locationService.getAddressFormatter().getFormMappings(),addressCollection:[],counter:0,captchaResponse:null},this.gtmLocationService=this.props.locationService.getGTMLocationService()}componentDidMount(){this.fetchAddresses()}render(){const e={addressCollection:this.state.addressCollection,formMappings:this.state.formMappings,locationService:this.props.locationService,onAddressChange:this.onAddressChange};return(0,A.jsx)(L.$,{translation:Object.assign({},this.props.translations),children:(0,A.jsxs)("div",{className:"corporate-address-bar",children:[this.props.isDropdown?(0,A.jsx)(X,Object.assign({},e,{appConfig:this.props.appConfig,listDisplayed:this.state.listDisplayed,toggleLocationSelection:this.toggleLocationSelection,selectedAddress:this.props.selectedAddress})):(0,A.jsx)(U,Object.assign({},e,{isMView:this.props.isMView,onCancelSearch:this.props.onCancelSearch})),this.state.captchaResponse&&this.props.showCaptcha&&(0,A.jsx)(O.R,{onSubmit:()=>this.fetchAddresses(),captchaResponse:this.state.captchaResponse})]})})}}const Z=(0,I.Z)(z,"CorporateLocationInput");var Y=s("f799360550622a669e28"),q=s("a7f44a4d9a149fde3658");let J=function(e){return e.RefreshDropdownModal="location-dropdown-modal",e}({});var $=s("ef7f39a531ad1aecc167"),Q=s("6c98f6eb5d8c8e24aa4d"),ee=s.n(Q),te=s("fadff784fe9d907204ad"),se=s.n(te);const ie=e=>{let{isTooltipVisible:t,dismissTooltip:s,noLocationTooltipKey:i}=e;const[o,a]=(0,v.useState)(!1),n=(0,H.T)(),{navbar_locationinput_tooltip:r}=K.w;return(0,v.useEffect)((()=>{if(o)return;const e=()=>{a(!0),s()};return document.addEventListener("click",e),()=>{document.removeEventListener("click",e)}}),[o,s]),(0,A.jsx)("div",{className:"missing-address-tooltip-container","data-testid":"missing-address-tooltip-container",children:(0,A.jsx)(se(),{className:"missing-address-tooltip",arrowAlignment:"left",placement:"bottom",isVisibleForAnimation:t,bodyText:n(i||r)})})},oe=e=>{let{addressFormatted:t,addressLabel:s,hasError:i,hasExpandWhereComponent:o,hasOverlay:n,isExpanded:r,onClick:c,shouldShowMissingLocationTooltip:l,noLocationTooltipKey:h}=e;const p=y()("location-search-button",{"header-order-button-open":o},{"with-overlay":n}),[u,m]=(0,v.useState)(l);return(0,A.jsx)("div",{className:"location-header-display",children:(0,A.jsx)(d.Button,{className:p,onClick:()=>c(u?M.u.TOOLTIP_SOURCE:M.u.ADDRESS_BOX_SOURCE),"data-testid":"location-search-button",id:"location-search-button","aria-haspopup":!0,"aria-expanded":r,variant:"text",size:"small",removeSideSpacing:!0,children:(0,A.jsxs)("div",{className:"address-content",children:[(0,A.jsx)(a.Box,{as:"span",className:"address-label-icon","data-testid":"address-label-icon",children:(0,A.jsx)(ee(),{})}),(0,A.jsxs)(g.Typography,{as:"span",color:"interaction-primary",type:"label-md",className:y()("header-order-button-content",{"header-order-button-content--error":i}),children:[(0,A.jsx)(g.Typography,{as:"span",type:"label-md",color:"neutral-primary",className:y()("address-label-highlighted-header",{"address-label-highlighted-header--no-content":!Boolean(null==s?void 0:s.length)}),"data-testid":"address-label-highlighted-header",children:s}),u&&(0,A.jsx)(ie,{isTooltipVisible:u,dismissTooltip:()=>m(!1),noLocationTooltipKey:h}),t]})]})})})},ae=e=>{let{expandWhereComponent:t,overlayHeader:s,onClick:i,expanded:o,expeditionType:a,selectedAddress:n,addressModel:r,noLocationTooltipKey:d}=e;const c=(0,H.T)(),{delivery_by_city:l,dine_in_near_address:h,pickup_near_address:p,select_your_address_label:u,navbar_locationinput_location:g}=K.w,m=void 0!==n&&0!==n.length,f=N.ZP.getInstance().getUser().currentCityName,v=!m;return(0,A.jsx)(oe,{addressFormatted:m?n:f||c(u),addressLabel:!m&&f?c(g):(0,$.FE)((0,$.Kt)(c),r),addressModel:r,expeditionType:(e=>{switch(e){case S.qE.DELIVERY:return c(l);case S.qE.DINE_IN:return c(h);default:return c(p)}})(a),hasError:!m,hasExpandWhereComponent:t,hasOverlay:s,isExpanded:o,onClick:i,shouldShowMissingLocationTooltip:v,noLocationTooltipKey:d})};var ne=s("54bdd803dcbe7795ce01"),re=s.n(ne),de=s("1c2f52c061810467b454");const ce=(e,t)=>{if(t)return N.ZP.getInstance().getAddressFormatter().getFormattedAddress(e,t.replace("plz","postcode"))},le=e=>(e=>(e.address_line1?e.address_line1:"")+" \n            "+(e.address_line2?e.address_line2:""))(e)+" "+(e=>e.entrance?e.entrance:"")(e);const he=(e,t)=>e.reduce(((e,s)=>e+" "+ce(t,s)),""),pe=e=>{let{userAddress:t,locationConfig:s,isAddressLabled:i,OTP:o}=e;const a=s.address_config.addressbook_format;return a?(0,A.jsx)(A.Fragment,{children:i?(0,A.jsxs)(A.Fragment,{children:[o&&(0,A.jsx)(g.Typography,{type:"label-md",children:t.label}),(0,A.jsx)(g.Typography,{type:"paragraph-sm",className:"one-line",children:he(a,t)})]}):(0,A.jsx)(A.Fragment,{children:a.map(((e,s)=>(0,A.jsx)(g.Typography,{type:0===s?"label-md":"paragraph-sm",marginBottom:0===s?"xxxs":"zero",className:"one-line",children:ce(t,e)},s)))})}):(0,A.jsx)(g.Typography,{type:"label-md",children:le(t)})},ue=e=>{let{userAddress:t,locationConfig:s,isAddressLabled:i}=e;return(0,A.jsx)(n(),{children:(0,A.jsx)(pe,{userAddress:t,locationConfig:s,isAddressLabled:i})})};var ge=s("20ef6f62b441041a6df6"),me=s.n(ge),Se=s("1333f57484f8a3e8deed"),fe=s.n(Se),ve=s("dbffb54a2bce39094d72"),be=s.n(ve),Ae=s("b6cb1298f374616152a5"),Ce=s.n(Ae);const Le=e=>{var t;let{address:s,open:i,onClose:o,onCancel:n,onConfirm:d,checkoutWebRefrsh:c}=e;const l=(0,H.T)(),{DELETE_ADDRESS_MODAL_TITLE:h,DELETE_ADDRESS_MODAL_MESSAGE:p,DELETE_ADDRESS_MODAL_CANCEL:u,DELETE_ADDRESS_MODAL_CONFIRM:m,location_button_confirm:S}=K.w,f=null===(t=l(h))||void 0===t?void 0:t.replace("%address%",s.formatted_customer_address||""),v=c?l(m)+"?":f,b=l(p),C=c?l(p).replace(/\?/g,": "+s.formatted_customer_address||0)+"?":b;return(0,A.jsxs)(Ce(),{isOpen:i,onClose:o,closable:!0,width:[30,90,90,90],padding:"md",className:"delete_modal",children:[(0,A.jsx)(a.Box,{marginRight:"xl",children:(0,A.jsx)(Ae.ModalTitle,{title:v})}),(0,A.jsx)(g.Typography,{type:"paragraph-md",marginBottom:"md",children:C}),(0,A.jsxs)(Ae.ModalFooter,{children:[(0,A.jsx)(r.Button,{className:"ma-xxs",kind:"secondary",onClick:n,"data-testid":"cancel-dialog-cta",children:l(u)}),(0,A.jsx)(r.Button,{className:"ma-xxs",kind:"primary",onClick:d,"data-testid":"confirm-dialog-cta",children:l(S)})]})]})};Le.displayName="DeleteAddressConfirmationModal";const _e=e=>{let{isActiveAddress:t,address:s,onDeleteAddress:i,editHandler:o,gtmLocationService:n}=e;const[d,c]=(0,v.useState)(!1),l=()=>{c(!d)};return(0,A.jsxs)(A.Fragment,{children:[(0,A.jsxs)(a.Box,{className:"saved-address-tooltip","data-testId":"tooltip-content",direction:"row",children:[(0,A.jsx)(r.Button,{className:"tooltip-button","data-testId":"tooltip-edit-button",onClick:()=>o(s),kind:"text",children:(0,A.jsx)(be(),{fill:"interaction-primary"})}),t?(0,A.jsx)(r.Button,{kind:"text",children:(0,A.jsx)(me(),{fill:"interaction-primary"})}):(0,A.jsx)(r.Button,{className:"tooltip-button",id:"delete-btn","data-testId":"tooltip-delete-button",onClick:()=>{c(!0),n.trackDeletePopupOnAddressList(s)},kind:"text",children:(0,A.jsx)(fe(),{fill:"interaction-primary"})})]}),(0,A.jsx)(Le,{address:s,open:d,onConfirm:()=>{c(!1);N.ZP.getInstance().getAddressService().deleteAddress(s.id),i(s)},onCancel:l,onClose:l})]})},Ee=e=>{var t;let{appConfig:s,address:i,isActiveAddress:o,isAddressLabled:n,onAddressSelect:r,onMouseEnter:d,isFocused:c,onDeleteAddress:l,editHandler:h,gtmLocationService:p}=e;const u=(0,H.T)(),g=(0,$.FE)((0,$.Kt)(u),i),S=y()({"is-active-saved-address":o});return(0,A.jsxs)(a.Box,{id:"saved-address-wrapper",direction:"row",wrap:"nowrap",width:100,paddingRight:"sm",className:S,children:[(0,A.jsxs)(a.Box,{id:null===(t=i.id)||void 0===t?void 0:t.toString(),"data-testid":"saved-address-list-item-container",onClick:()=>r(i),className:y()("address-info",{focused:c}),children:[(0,A.jsx)(a.Box,{className:"saved-address-icon",children:(0,de.v)(i.type,o?"interaction-primary":"neutral-secondary")}),(0,A.jsxs)(a.Box,{className:"saved-address-list-item","data-testid":"saved-address-list-item",onMouseEnter:()=>d(i),width:100,children:[g&&(0,A.jsx)(m(),{as:"span",type:"label-md",marginBottom:"xxxs",children:g}),(0,A.jsx)(ue,{userAddress:i,locationConfig:s,isAddressLabled:n})]})]}),(0,q.J)(!0)&&!(e=>null!==e.corporate_reference_id&&(0,$.Fz)(e.type)===j._.COMPANY)(i)&&(0,A.jsx)(_e,{gtmLocationService:p,onDeleteAddress:l,editHandler:h,address:i,isActiveAddress:o})]})};Ee.displayName="SavedAddressListItem";const ye=()=>{const e=(0,H.T)(),{saved_addresses_label:t}=K.w;return(0,A.jsxs)(m(),{as:"span",type:"label-sm",marginBottom:"st",tabIndex:0,className:"saved-address-label",children:[" ",e(t)," "]})},xe=e=>{let{onDeleteAddress:t,appConfig:s,selectedAddress:i,savedAddresses:o,onSelect:n,editHandler:r,gtmLocationService:d}=e;const c=(0,H.T)(),[l,h]=(0,v.useState)({}),p=e=>h(e),u=e=>(0,$.FE)((0,$.Kt)(c),e)||"",g=e=>i.id===e.id,m=e=>l&&re()(e,l),{isMobileDevice:S}=(0,_.Z)();return(0,A.jsxs)(A.Fragment,{children:[(0,q.J)(!0)&&S?null:(0,A.jsx)(ye,{}),(0,A.jsx)(a.Box,{width:100,alignItems:"start",role:"radio-group","data-testid":"saved-addresses-list",className:"saved-address-list",children:o.map((e=>(0,A.jsx)(Ee,{gtmLocationService:d,editHandler:r,onDeleteAddress:t,address:e,appConfig:s,isActiveAddress:g(e),isAddressLabled:!!u(e),onAddressSelect:e=>(e=>{h({}),n(e)})(e),onMouseEnter:p,isFocused:m(e)},e.id)))})]})};xe.displayName="SavedAddressList";const Te=()=>window.innerWidth>=960,Ne=e=>{let{onClick:t,ariaLabel:s}=e;return(0,A.jsx)(r.Button,{"aria-label":s,className:"location-search-go-icon button js-ripple ml-sm","data-testid":"location-search-go-icon",onClick:t,children:(0,A.jsx)(l(),{fill:"white"})})};class Me extends v.PureComponent{constructor(e){super(e),this.addressSearchViewRef=void 0,this.gtmLocationService=void 0,this.makeSelectesItemFirstItem=e=>{this.setState((t=>{let{savedAddresses:s}=t;const i=(0,w.iv)(s,e);return i.unshift(e),{savedAddresses:e.id?i:s}}))},this.clearEditMode=()=>{this.setState({editedAddress:null})},this.onSubmitAddress=(e,t)=>{this.setState((s=>{let{savedAddresses:i}=s;const o=e.id?i.filter((t=>t.id!==e.id)):i;return{savedAddresses:[...(0,w.Nr)(o,t),t],selectedAddress:t.formatted_customer_address,addressModel:t,expandWhereComponent:!1}}))},this.hideAddressList=()=>{this.setState({showSavedAddress:!1})},this.setDropdownPosition=()=>{const e=document.querySelector(".address-label-icon");if(e){const t=e.getBoundingClientRect(),s=document.body.style;s.setProperty("--whereComponentTop",t.bottom+12+"px"),s.setProperty("--whereComponentLeft",t.left+"px"),s.setProperty("margin-right","0px","important")}},this.addNewAddressButtonHandler=()=>{this.setState({showMapView:!0})},this.showAddressForm=this.showAddressForm.bind(this),this.toggleComponentVisibility=this.toggleComponentVisibility.bind(this),this.submitAddress=this.submitAddress.bind(this),this.submitFormAddress=this.submitFormAddress.bind(this),this.addressSearchViewRef=v.createRef(),this.handleBodyClick=this.handleBodyClick.bind(this),this.onCancelSearch=this.onCancelSearch.bind(this),this.onSavedAddressSelect=this.onSavedAddressSelect.bind(this),this.onSuggestionListChanged=this.onSuggestionListChanged.bind(this),this.onDeleteAddress=this.onDeleteAddress.bind(this),this.editHandler=this.editHandler.bind(this),this.state={expandWhereComponent:!1,showSearchView:!1,selectedAddress:e.locationService.getModel().formatted_customer_address,addressModel:e.locationService.getModel(),showWhereComponent:!0,expeditionType:e.expeditionType,corporateForceSelect:!1,showMapView:e.showMap||!1,corporateUserInfo:null,savedAddresses:[],showSavedAddress:!1,editedAddress:null,captchaResponse:null},this.gtmLocationService=e.locationService.getGTMLocationService()}initAddressSuggestions(){return(0,T.ZP)(this.props.appConfig,!0,this.props.locationService.getAddressService())}showNewLocationHeader(){return!!(0,q.J)(!0)||Te()}getSavedAddresses(){this.showNewLocationHeader()&&this.initAddressSuggestions().call(this,"",0,"saved address",!1).then((e=>{this.setState({savedAddresses:(null==e?void 0:e.length)>0?[...e]:[],captchaResponse:null},(()=>{const e=this.state.savedAddresses.find((e=>e.id==this.state.addressModel.id));e&&this.makeSelectesItemFirstItem(e)}))})).catch((e=>{var t;const s=N.ZP.getInstance().getLocationXhrService().isAppIdExist(e),i=(null==e||null===(t=e.response)||void 0===t?void 0:t.data)||e;s&&this.setState({captchaResponse:i})}))}async componentDidMount(){const{user:e,showMap:t,onLoad:s}=this.props;if(this.setupEventListener(),this.getSavedAddresses(),null!=e&&e.corporateUser){const t=e.corporateUser;this.setState({corporateUserInfo:t},(()=>{var e;"5"===this.props.locationService.getModel().type||null!==(e=this.state.corporateUserInfo)&&void 0!==e&&e.isAllowedFlexibleAddress||(this.showAddressForm(M.u.ADDRESS_BOX_SOURCE),this.setState({corporateForceSelect:!0}))}))}t&&this.toggleComponentVisibility(),s&&s()}setupEventListener(){this.props.locationService.getEventLord().on("vendor:deliverable",this.showWhereComponent.bind(this)),this.props.locationService.getEventLord().on("rdp-dilog:clicked",this.toggleComponentVisibility.bind(this)),this.props.locationService.getEventLord().on("expedition:changed",this.toggleExpedition.bind(this)),globalThis.addEventListener("resize",this.setDropdownPosition)}showWhereComponent(){var e;this.setState({showWhereComponent:!0,selectedAddress:null===(e=this.props.locationService.getValidatedModel(["formatted_customer_address"]))||void 0===e?void 0:e.formatted_customer_address})}onSavedAddressSelect(e){const{locationService:t,vendorCart:s}=this.props;this.gtmLocationService&&(this.gtmLocationService.initializeLocationAttemptedTracking("Saved"),this.gtmLocationService.trackLocationClicked(e,s,"NA","Saved"),this.gtmLocationService.trackLocationAttempted(e),this.gtmLocationService.trackSubmittedLocation(e,"Saved")),this.submitAddress(e),t.getEventLord().emit("address:changed",e),t.getEventLord().emit("full-address-search-location-bar:submit",e)}editHandler(e){this.setState({showMapView:!0,editedAddress:e}),this.gtmLocationService.trackEditOnAddressList(e,M.P.EDIT_ADDRESS)}onDeleteAddress(e){const{locationService:t}=this.props;this.gtmLocationService.initializeLocationAttemptedTracking("DeleteButton"),this.gtmLocationService.trackLocationAttempted(t.getModel(),void 0,M.P.AVAILABLE_ADDRESS_LIST),this.setState((t=>{let{savedAddresses:s}=t;return{savedAddresses:(0,w.iv)(s,e)}}))}onSuggestionListChanged(e){const t=!((null==e?void 0:e.length)>0)&&this.state.savedAddresses.length>0;this.setState({showSavedAddress:t})}render(){const{expandWhereComponent:e,corporateForceSelect:t,showSearchView:s,showWhereComponent:i,expeditionType:o,selectedAddress:a,showMapView:r,savedAddresses:d,showSavedAddress:c}=this.state,{locationService:l,appConfig:h,googleMapScriptLoader:g,vendorCart:S,translations:f,tooltipPlacement:v,addressCollection:b,disableAutoInputValidation:E,linkedAccount:x,noLocationTooltipKey:T}=this.props,{isMobileDevice:N}=(0,_.Z)(),M=(0,q.J)(!0)&&N,w=y()("location-search-component fade react",{open:e,"location-serach-component-Mweb":M}),I=t&&(!s||s&&!e),D=(0,A.jsxs)(n(),{direction:"row",className:"search-form",children:[(0,A.jsx)("div",{className:"address-search-container",id:"address-search-container","data-testid":"address-search-container",children:(0,A.jsx)(Y.Pc,{hideAddressList:this.hideAddressList,savedAddresses:d,isWhereComponent:!0,onSubmitAddress:this.onSubmitAddress,editedAddress:this.state.editedAddress,clearEditMode:this.clearEditMode,fillInputSearch:e,fullAddressSearchEventName:"full-address-search-location-bar:submit",ref:this.addressSearchViewRef,locationService:l,appConfig:h,googleMapScriptLoader:g,expeditionType:o,focusOnRender:!1,showSavedAddress:!this.showNewLocationHeader(),showSuggestions:!0,trackUpdate:!0,autoSubmit:!Te(),showPlaceholder:!0,vendorCart:S,onChange:this.submitAddress,onCancelSearch:this.onCancelSearch,onCloseMap:this.onCancelSearch,translations:f,tooltipPlacement:v,addressCollection:b,disableAutoInputValidation:E,showMapView:r,onSuggestionListChanged:this.onSuggestionListChanged})}),(0,A.jsxs)(n(),{className:y()({"location-search-button-Mweb":(0,q.J)(!0)}),children:[(0,A.jsx)(Ne,{onClick:this.submitFormAddress,ariaLabel:f.map_submit_btn})," "]})]}),j=(0,A.jsxs)(A.Fragment,{children:[c&&(0,A.jsx)(xe,{gtmLocationService:this.gtmLocationService,onDeleteAddress:this.onDeleteAddress,editHandler:this.editHandler,appConfig:h,savedAddresses:d,selectedAddress:l.getModel(),onSelect:this.onSavedAddressSelect}),0===d.length&&M?(0,A.jsxs)(n(),{alignItems:"center",children:[(0,A.jsx)(n(),{className:"no-saved-address-img"}),(0,A.jsx)(m(),{"data-testId":"no-saved-address",id:"no-saved-address",width:80,children:f.no_saved_addresses_hint})]}):null]}),k=(0,A.jsx)(A.Fragment,{children:(0,A.jsxs)(n(),{className:"addNewAddress-component add-new-address-button","data-testId":"add-new-address-button",onClick:this.addNewAddressButtonHandler,children:[(0,A.jsx)(p(),{height:30,width:30,fill:"interaction-primary"}),f.add_new_address_title]})});return i&&(0,A.jsxs)(L.$,{translation:Object.assign({},f),children:[(0,A.jsx)(ae,{appConfig:this.props.appConfig,addressModel:this.state.addressModel,onClick:this.showAddressForm,expeditionType:o,selectedAddress:a,expandWhereComponent:e,overlayHeader:I,isMobile:!Te(),expanded:e,noLocationTooltipKey:T}),(0,A.jsxs)(u.ZP,{className:"webfound-refresh location-dropdown","data-testid":J.RefreshDropdownModal,isOpen:e,onClose:this.toggleComponentVisibility,scrollBehaviour:"outside",size:"md",closeOnBackdropClick:!1,children:[(0,A.jsxs)(u.l6,{children:[(0,A.jsx)(u.ol,{variant:"basic",ariaLabel:"Close"}),(0,A.jsx)(u.xB,{title:f.location_map_title,subtitle:f.NEXTGEN_LOCATION_MAP_MODAL_SUBTITLE,subtitleId:"webfound-refresh-location-subtitle"}),(0,A.jsx)(u.hz,{children:(0,A.jsx)(u.fe,{children:(0,A.jsxs)(n(),{direction:"column",className:"where-component-search-form",width:100,children:[this.shouldShowVOLOInput()?(0,A.jsxs)(A.Fragment,{children:[(0,A.jsx)(n(),{className:"LocationSearchForm-component",children:D}),k,j]}):(0,A.jsx)("div",{className:w,children:(0,A.jsx)("div",{className:"corporate-address-search-container",id:"corporate-address-search-container","data-testid":"corporate-address-search-container",children:(0,A.jsx)(C,{tags:{boundaryId:"corporate_admin-rendering-location_input"},children:(0,A.jsx)(Z,{appConfig:h,locationService:l,translations:f,selectedAddress:a,onChange:this.submitAddress,fullAddressSearchEventName:"full-address-search-location-bar:submit",expeditionType:o,onCancelSearch:this.onCancelSearch,isMView:s,linkedAccount:x})})})}),this.state.captchaResponse&&(0,A.jsx)(O.R,{onSubmit:()=>this.getSavedAddresses(),captchaResponse:this.state.captchaResponse})]})})})]}),(0,A.jsx)(u._n,{})]})]})}onCancelSearch(){this.setState({showSearchView:!1,expandWhereComponent:!1,showMapView:!1}),this.removeOrderComponent()}showAddressForm(e){this.state.expandWhereComponent?this.removeOrderComponent():(this.trackAddressUpdateClicked(e||void 0),this.addOrderComponent(),this.showNewLocationHeader()&&this.setState({showSavedAddress:this.state.savedAddresses.length>0})),this.toggleComponentVisibility()}toggleComponentVisibility(){document.querySelector(".webfound-refresh .overlay-modal")||(this.setState((e=>({expandWhereComponent:!e.expandWhereComponent}))),(0,q.J)(!0)||Te()?this.setState({showSearchView:!1}):this.setState({showMapView:!0}),this.setDropdownPosition())}toggleExpedition(e){if(e&&e!==this.state.expeditionType)this.setState({expeditionType:e});else if(!e){const e=this.state.expeditionType===S.qE.PICKUP&&S.qE.DELIVERY||S.qE.PICKUP;this.setState({expeditionType:e})}}submitFormAddress(){const e=this.addressSearchViewRef.current;e&&e.handleInputAddressSubmit({isUpdate:!0,type:"Manual"},this.state.expeditionType)}componentWillUnmount(){document.body.removeEventListener("click",this.handleBodyClick),globalThis.removeEventListener("resize",this.setDropdownPosition)}addOrderComponent(){document.body.classList.add("show-order-components")}removeOrderComponent(){this.state.corporateForceSelect||document.body.classList.remove("show-order-components")}handleBodyClick(e){const t=document.getElementsByClassName("where-wrapper")[0],s=document.getElementsByClassName("overlay-header-for-location")[0];if(t){(e.target===t||t.contains(e.target))&&e.target!==s||(this.state.corporateForceSelect?(e.preventDefault(),this.addOrderComponent()):(this.setState({expandWhereComponent:!1}),this.removeOrderComponent()))}}trackAddressUpdateClicked(e){this.gtmLocationService.trackAddressUpdateClicked(this.props.locationService.getModel(),e||void 0)}isVendorPage(){return null!==document.querySelector(".menu")}isGroceriesPage(){return null!==document.querySelector(".groceries-body")}submitAddress(e){this.makeSelectesItemFirstItem(e),this.setState({selectedAddress:e.formatted_customer_address,addressModel:e,corporateForceSelect:!1,expandWhereComponent:!1},(()=>{(this.isVendorPage()||this.isGroceriesPage())&&this.props.locationService.getEventLord().emit("location:change",e),this.removeOrderComponent()}))}shouldShowVOLOInput(){var e,t;return null===(e=this.props.user)||void 0===e||!e.corporateUser||(null===(t=this.props.user)||void 0===t?void 0:t.corporateUser.isAllowedFlexibleAddress)}}const we=(0,I.Z)(Me,"WhereComponent");var Oe=s("fac2effa2380bfd3e70d"),Ie=s("8bf191ce59421ef0bd7c"),De=s("e57816ce2d5f3e48376c"),je=s("1baf79ef3423d492ef49"),ke=s("207ea314cce7e9d4498b"),Re=s("ca99f684b2feb78ef70d");const Pe=e=>{let{translations:t,expeditionType:s,user:a,userCurrentCityName:n,latitude:r,longitude:d,onLoad:c}=e;const l=(0,v.useCallback)((async()=>{const e=N.ZP.getInstance(),o=e.getConfig(),l=(0,Oe.h)(o);e.loadFromLocal();const h=e.getModel(),p=String(h.latitude)===r,u=String(h.longitude)===d,g=p&&u;var m,S;n&&e.setUser({currentCityName:n}),!(0,Ie.e)(ke.z.COOKIE_STORAGE_KEY)&&h.latitude&&h.longitude&&((0,Re.F)({[i.M.Latitude]:h.latitude,[i.M.Longitude]:h.longitude}),await e.setModel(h),(0,De.v)().emit(je.eN.LocationChange,h)),g||""===d||""===r||await e.setFromLatLng(r,d),S=Object.assign({appConfig:o,googleMapScriptLoader:l,locationService:e,translations:t,expeditionType:s,user:a},m&&{showMap:!0},{onLoad:c}),(0,x.render)((0,A.jsx)(we,Object.assign({},S)),document.querySelector(".where-wrapper"))}),[s,t,a,n,r,d,c]);return(0,v.useEffect)((()=>{l()}),[l]),(0,A.jsx)("div",{className:o,"data-testid":o})}},f5d17e56377a8716bb2c:e=>{e.exports=function(e,t){for(var s=-1,i=null==e?0:e.length;++s<i;)if(!t(e[s],s,e))return!1;return!0}},"626a983654c177b499d0":(e,t,s)=>{var i=s("6457124f80daf60d4cdd");e.exports=function(e,t){var s=!0;return i(e,(function(e,i,o){return s=!!t(e,i,o)})),s}},aa19b366ad39a81067fe:(e,t,s)=>{var i=s("f5d17e56377a8716bb2c"),o=s("626a983654c177b499d0"),a=s("28d35b52da28abc513f5"),n=s("ac1b2ff296e6e8845a4f"),r=s("3f72c7c3b3c2572df117");e.exports=function(e,t,s){var d=n(e)?i:o;return s&&r(e,t,s)&&(t=void 0),d(e,a(t,3))}},"54bdd803dcbe7795ce01":(e,t,s)=>{var i=s("e27a8ddae5989644a646");e.exports=function(e,t){return i(e,t)}},"56d5f2391e2ec098aa40":(e,t,s)=>{var i=s("41e212fa37c48358d10c"),o=s("a336d6a79037da5f57bf"),a=s("28d35b52da28abc513f5");e.exports=function(e,t){var s={};return t=a(t,3),o(e,(function(e,o,a){i(s,o,t(e,o,a))})),s}},fadff784fe9d907204ad:function(e,t,s){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,s,i){void 0===i&&(i=s),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[s]}})}:function(e,t,s,i){void 0===i&&(i=s),e[i]=t[s]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var s in e)"default"!==s&&Object.prototype.hasOwnProperty.call(e,s)&&i(t,e,s);return o(t,e),t},n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Tooltip=void 0;const r=n(s("2a2f6f9fc1fcbea04a83")),d=a(s("69084d01d3449fc1bc27")),c=s("357b5e421c562f4d34f8"),l=n(s("43ccb349c11a0dc4e7b4")),h=s("9f3f340b65c456465766");t.Tooltip=e=>{const{className:t,placement:s="bottom",arrowAlignment:i="center",isVisibleForAnimation:o,forwardedRef:a}=e,n=s||"top",l=!i||"top"!==s&&"bottom"!==s?"":`align-${i}`,p=d.useRef(!1);!0===o&&(p.current=!0);const u=r.default(t,n,l,{"animate-initial-state":!1===p.current&&void 0!==o,"animate-in":o,"animate-out":p.current&&!1===o});return d.default.createElement(c.Box,{position:"relative",forwardedRef:a},e.children,d.default.createElement(c.Box,{id:"tooltip",className:u,elevation:1,position:"absolute",borderRadius:"xs"},d.default.createElement(c.Box,{className:"tooltip-arrow",elevation:1,background:"information"}),d.default.createElement(c.Box,{className:"tooltip-inner",padding:"sm",background:"information",color:"white",borderRadius:"xs"},d.default.createElement(h.Typography,{className:"tooltip-inner-text",type:"paragraph-xs",as:"span"},e.bodyText))))},t.Tooltip.displayName="Tooltip",t.default=l.default(t.Tooltip)}}]);
//# sourceMappingURL=components-location-picker.6745e294e1fa135321a7.esm.js.map